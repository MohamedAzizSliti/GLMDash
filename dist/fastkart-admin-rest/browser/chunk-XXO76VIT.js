import{a as ce,m as te}from"./chunk-O55BQOZL.js";import{a as ee}from"./chunk-ISOQKGNC.js";import{A as ke,B as je,Bc as Xe,Dc as Ze,E as k,Fa as Qe,G as Ne,H as Be,L as Re,O as qe,Oa as We,T as Pe,Ua as He,a as I,aa as Ue,ab as Ye,ba as Le,ca as Ge,da as Oe,fb as ze,k as A,l as $e,lb as j,m as F,n as Ae,o as O,p as X,qb as Je,rb as Ke,y as Me,z as M}from"./chunk-X2K52VJG.js";import{$,Aa as ye,Bc as xe,C as fe,Ca as n,Da as v,Ia as ge,Ib as G,Nb as u,Nc as Te,Ob as f,P as he,Pc as K,Q as ve,Qa as w,Qc as Ve,Rb as pe,S as C,Sa as a,Sc as de,Ua as De,Vc as Z,Wa as be,Y as W,Z as H,ab as d,bb as p,bc as we,c as le,cb as h,da as S,ea as Y,gb as z,h as m,j as me,jb as T,kc as Ie,la as y,ma as g,nb as L,nc as Fe,q as ue,rb as _e,sb as Ce,tb as Se,ub as J,vc as Ee,wb as D,yb as b}from"./chunk-V4SAOAZP.js";import{a as P,b as U}from"./chunk-CWTPBX7D.js";var N=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Depense] Get";let i=e;return i})(),ie=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Depense] Create";let i=e;return i})(),re=(()=>{let e=class e{constructor(t){this.id=t}};e.type="[Depense] Edit";let i=e;return i})(),oe=(()=>{let e=class e{constructor(t,o){this.payload=t,this.id=o}};e.type="[Depense] Update";let i=e;return i})(),et=(()=>{let e=class e{constructor(t,o){this.id=t,this.status=o}};e.type="[Depense] Update Status";let i=e;return i})(),ne=(()=>{let e=class e{constructor(t){this.id=t}};e.type="[Depense] Delete";let i=e;return i})(),ae=(()=>{let e=class e{constructor(t){this.ids=t}};e.type="[Depense] Delete All";let i=e;return i})();var tt=(()=>{let e=class e{constructor(t){this.http=t}getDepenses(t){return this.http.get(`${I.URL}/depense`,{params:t})}createDepense(t){return this.http.post(`${I.URL}/depense`,t)}editDepense(t){return this.http.get(`${I.URL}/depense/${t}`)}updateDepense(t,o){return this.http.put(`${I.URL}/depense/${t}`,o)}updateDepenseStatus(t,o){return this.http.put(`${I.URL}/depense/${t}/${o}`,{})}deleteDepense(t){return this.http.delete(`${I.URL}/depense/${t}`)}deleteAllDepense(t){return this.http.post(`${I.URL}/depense/deleteAll`,{ids:t})}};e.\u0275fac=function(o){return new(o||e)($(xe))},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var _,c=(_=class{constructor(e,r,t){this.store=e,this.notificationService=r,this.depenseService=t}static depense(e){return e.depense}static currencies(e){return e.depense.data.map(r=>({label:r?.code,value:r?.id}))}static selectedDepense(e){return e.selectedDepense}getDepenses(e,r){return this.depenseService.getDepenses(r.payload).pipe(C({next:t=>{e.patchState({depense:{data:t.data,total:t?.total?t?.total:t.data?.length}})},error:t=>{throw new Error(t?.error?.message)}}))}create(e,r){return this.depenseService.createDepense(r.payload).pipe(C({next:t=>{let o=e.getState();e.patchState(U(P({},o),{depense:{data:[...o.depense.data,t],total:o?.depense.total+1}}))},complete:()=>{this.notificationService.showSuccess("Depense Created Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}edit(e,{id:r}){return this.depenseService.editDepense(r).pipe(C({next:t=>{let o=e.getState();e.patchState(U(P({},o),{selectedDepense:t}))},error:t=>{throw new Error(t?.error?.message)}}))}update(e,{payload:r,id:t}){return this.depenseService.updateDepense(t,r).pipe(C({next:o=>{if(typeof o=="object"){let s=e.getState(),l=[...s.depense.data],x=l.findIndex(q=>q.id===t);l[x]=o,e.patchState(U(P({},s),{depense:{data:l,total:s.depense.total}}))}},complete:()=>{this.notificationService.showSuccess("Depense Updated Successfully")},error:o=>{throw new Error(o?.error?.message)}}))}updateStatus(e,{id:r,status:t}){return this.depenseService.updateDepenseStatus(r,t).pipe(C({next:o=>{if(typeof o=="object"){let s=e.getState(),l=[...s.depense.data],x=l.findIndex(q=>q.id===r);l[x]=o,e.patchState(U(P({},s),{depense:{data:l,total:s.depense.total}}))}},complete:()=>{this.notificationService.showSuccess("Depense Status Updated Successfully")},error:o=>{throw new Error(o?.error?.message)}}))}delete(e,{id:r}){return this.depenseService.deleteDepense(r).pipe(C({next:()=>{this.store.dispatch(new N({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("Depense Deleted Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}deleteAll(e,{ids:r}){return this.depenseService.deleteAllDepense(r).pipe(C({next:()=>{this.store.dispatch(new N({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("Depense Deleted Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}},_.\u0275fac=function(r){return new(r||_)($(A),$(Qe),$(tt))},_.\u0275prov=W({token:_,factory:_.\u0275fac}),_);m([F(N)],c.prototype,"getDepenses",null);m([F(ie)],c.prototype,"create",null);m([F(re)],c.prototype,"edit",null);m([F(oe)],c.prototype,"update",null);m([F(et)],c.prototype,"updateStatus",null);m([F(ne)],c.prototype,"delete",null);m([F(ae)],c.prototype,"deleteAll",null);m([X()],c,"depense",null);m([X()],c,"currencies",null);m([X()],c,"selectedDepense",null);c=m([Ae({name:"depense",defaults:{depense:{data:[],total:0},selectedDepense:null}})],c);var mt=["csvModal"],ut=()=>["/depenses/create"];function ft(i,e){i&1&&(d(0,"div",5)(1,"a",6),h(2,"i",7),D(3),u(4,"translate"),p()()),i&2&&(n(),a("routerLink",G(4,ut)),n(2),b(" ",f(4,2,"add_depense")," "))}var B=class B{constructor(e,r){this.store=e,this.router=r,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"Titre",dataField:"title",sortable:!0,sort_direction:"desc"},{title:"Date",dataField:"date",type:"date",sortable:!0,sort_direction:"desc"},{title:"Montant",dataField:"amount",type:"number",sortable:!0,sort_direction:"desc"},{title:"Cat\xE9gory",dataField:"category",type:"string",sortable:!0,sort_direction:"desc"},{title:"Voiture",dataField:"vehicle.title",type:"string",sortable:!0,sort_direction:"desc"}],rowActions:[{label:"Edit",actionToPerform:"edit",icon:"ri-pencil-line",permission:"vehicle.edit"},{label:"Delete",actionToPerform:"delete",icon:"ri-delete-bin-line",permission:"vehicle.destroy"}],data:[],total:0}}ngOnInit(){this.depense$.subscribe(e=>{this.tableConfig.data=e?e?.data:[],this.tableConfig.total=e?e?.total:0})}onTableChange(e){this.store.dispatch(new N(e))}onActionClicked(e){e.actionToPerform=="edit"?this.edit(e.data):e.actionToPerform=="delete"?this.delete(e.data):e.actionToPerform=="deleteAll"&&this.deleteAll(e.data)}edit(e){this.router.navigateByUrl(`/depenses/edit/${e.id}`)}delete(e){this.store.dispatch(new ne(e.id))}deleteAll(e){this.store.dispatch(new ae(e))}export(){}};B.\u0275fac=function(r){return new(r||B)(v(A),v(K))},B.\u0275cmp=S({type:B,selectors:[["app-depense"]],viewQuery:function(r,t){if(r&1&&_e(mt,5),r&2){let o;Ce(o=Se())&&(t.CSVModal=o.first)}},decls:5,vars:6,consts:[["csvModal",""],[3,"gridClass","title"],["class","d-flex flex-wrap gap-2","button","",4,"hasPermission"],[3,"tableChanged","rowClicked","action","tableConfig","hasCheckbox"],[3,"module"],["button","",1,"d-flex","flex-wrap","gap-2"],[1,"align-items-center","btn","btn-theme","d-flex",3,"routerLink"],[1,"ri-add-line"]],template:function(r,t){if(r&1){let o=z();d(0,"app-page-wrapper",1),w(1,ft,5,5,"div",2),d(2,"app-table",3),T("tableChanged",function(l){return y(o),g(t.onTableChange(l))})("rowClicked",function(l){return y(o),g(t.edit(l))})("action",function(l){return y(o),g(t.onActionClicked(l))}),p()(),h(3,"app-import-csv-modal",4,0)}r&2&&(a("gridClass","col-sm-12")("title","depenses"),n(),a("hasPermission","vehicle.create"),n(),a("tableConfig",t.tableConfig)("hasCheckbox",!0),n(),a("module","attribute"))},dependencies:[Ve,Je,j,Xe,Ye,Z]});var Q=B;m([O(c.depense)],Q.prototype,"depense$",void 0);var ot=()=>[];function ht(i,e){if(i&1&&(d(0,"div",22),h(1,"img",23),p(),D(2)),i&2){let r=e.data;n(),be("img-fluid selection-image"),a("src",r.image,ye),n(),b(" ",r.name," ")}}function vt(i,e){if(i&1&&(d(0,"span",24),D(1),p()),i&2){let r=e.$implicit,t=e.focused;De("focused",t),n(),b(" ",r.day," ")}}function yt(i,e){i&1&&(d(0,"div",25),D(1),u(2,"translate"),p()),i&2&&(n(),b(" ",f(2,1,"start_date_is_required")," "))}function gt(i,e){i&1&&(d(0,"div",25),D(1),u(2,"translate"),p()),i&2&&(n(),b(" ",f(2,1,"name_is_required")," "))}function Dt(i,e){i&1&&(d(0,"div",25),D(1),u(2,"translate"),p()),i&2&&(n(),b(" ",f(2,1,"amount_is_required")," "))}function bt(i){return new Ue(i.year,i.month,i.day)}var R=class R{constructor(e,r,t,o,s,l,x,q){this.store=e,this.route=r,this.formatter=t,this.calendar=o,this.router=s,this.document=l,this.renderer=x,this.formBuilder=q,this.documents=[{value:"",hex_color:"",id:""}],this.destroy$=new le,this.variantStyle=[{value:"carburant",label:"Carburant"},{value:"assurance",label:"Assurance"},{value:"r\xE9paration",label:"R\xE9paration"},{value:"entretien",label:"Entretien"},{value:"administrative",label:"Administrative"},{value:"achat",label:"Achat"},{value:"amendes",label:"Amende"},{value:"autres",label:"Autre"}],this.search=new le;let se=new Date;this.today={year:se.getFullYear(),month:se.getMonth()+1,day:se.getDate()},this.form=this.formBuilder.group({title:new k("",[M.required]),category:new k("carburant",[M.required]),selected_vehicles:new k,date:new k(this.today),amount:new k("",[M.required])})}get valueControl(){return this.form.get("value")}ngOnInit(){let e=new Date;this.today={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()},console.log("/***** The Value this.today ****/"),console.log(this.today),this.form.controls.date.setValue(this.today),console.log("Default date (today):",this.form.get("date")?.value),this.store.dispatch(new ce({status:1,is_approved:1,paginate:15})),this.route.params.pipe(he(r=>r.id?this.store.dispatch(new re(r.id)).pipe(ue(()=>this.store.select(c.selectedDepense))):me()),ve(this.destroy$)).subscribe(r=>{this.id=r?.id,this.fromDate=r?.date?bt(this.formatter.parse(r.date)):null,this.form.patchValue({title:r?.title,amount:r?.amount,category:r?.category,selected_vehicles:[r?.vehicle_id]}),this.form.controls.category.setValue(r?.category)}),this.search.pipe(fe(300)).subscribe(r=>{this.store.dispatch(new ce({status:1,is_approved:1,paginate:15,search:r})),this.renderer.addClass(this.document.body,"loader-none")})}add(e){e.preventDefault();let r=this.form.get("style").value==="color"?this.formBuilder.group({value:["",[M.required]],hex_color:[""]}):this.formBuilder.group({value:["",[M.required]]});this.valueControl.push(r)}remove(e){this.valueControl.length<=1||this.valueControl.removeAt(+e)}submit(){this.form.markAllAsTouched();let e=new ie(this.form.value);this.type=="edit"&&this.id&&(this.form.controls.date.setValue(`${this.fromDate.year}-${this.fromDate.month}-${this.fromDate.day}`),e=new oe(this.form.value,this.id)),this.form.valid&&this.store.dispatch(e).subscribe({complete:()=>{this.router.navigateByUrl("/depenses")}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}productDropdown(e){e.innerSearchText&&this.search.next("")}searchProduct(e){this.search.next(e.search)}onDateSelection(e){this.fromDate=e,this.fromDate&&this.form.controls.date.setValue(`${this.fromDate.year}-${this.fromDate.month}-${this.fromDate.day}`)}};R.\u0275fac=function(r){return new(r||R)(v(A),v(Te),v(Ge),v(Le),v(K),v(we),v(ge),v(Pe))},R.\u0275cmp=S({type:R,selectors:[["app-form-depense"]],inputs:{type:"type"},decls:43,vars:65,consts:[["template",""],["datepicker","ngbDatepicker"],["t",""],["dpFromDate",""],[1,"theme-form","theme-form-2","mega-form",3,"ngSubmit","formGroup"],[3,"labelClass","gridClass","label","for","required"],["formControlName","selected_vehicles","id","exclude_product",1,"custom-select",3,"close","search","data","templates","placeholder","noResultMessage","customSearchEnabled","multiple"],[3,"label","for","required"],[1,"dp-hidden","position-absolute","custom-dp-dropdown"],[1,"input-group"],["name","datepicker","ngbDatepicker","","outsideDays","hidden","tabindex","-1","readonly","",1,"form-control",3,"dateSelect","autoClose","displayMonths","dayTemplate"],[1,"input-group","custom-dt-picker"],["placeholder","yyyy-mm-dd","name","dpFromDate","readonly","",1,"form-control",3,"value"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"ri-calendar-line"],["class","invalid-feedback",4,"ngIf"],["type","text","name","name","formControlName","title",1,"form-control",3,"placeholder"],["formControlName","category",1,"custom-select","d-block",3,"data","placeholder","noResultMessage"],[1,"input-group-text"],["type","number","name","amount","formControlName","amount",1,"form-control",3,"placeholder"],[1,"border-up-class","mt-4"],[3,"id"],[1,"image"],[3,"src"],[1,"custom-day"],[1,"invalid-feedback"]],template:function(r,t){if(r&1){let o=z();d(0,"form",4),T("ngSubmit",function(){return y(o),g(t.submit())}),d(1,"app-form-fields",5)(2,"select2",6),u(3,"translate"),u(4,"async"),u(5,"async"),u(6,"translate"),T("close",function(l){return y(o),g(t.productDropdown(l))})("search",function(l){return y(o),g(t.searchProduct(l))}),w(7,ht,3,4,"ng-template",null,0,pe),p()(),d(9,"app-form-fields",7)(10,"div",8)(11,"div",9)(12,"input",10,1),T("dateSelect",function(l){return y(o),g(t.onDateSelection(l))}),p(),w(14,vt,2,3,"ng-template",null,2,pe),p()(),d(16,"div",11),h(17,"input",12,3),d(19,"button",13),T("click",function(){y(o);let l=J(13);return g(l.toggle())}),h(20,"i",14),p()(),w(21,yt,3,3,"div",15),p(),d(22,"app-form-fields",7),u(23,"translate"),h(24,"input",16),u(25,"translate"),w(26,gt,3,3,"div",15),p(),d(27,"app-form-fields",7),h(28,"select2",17),u(29,"translate"),u(30,"translate"),p(),d(31,"app-form-fields",5)(32,"div",9)(33,"span",18),D(34),u(35,"async"),u(36,"async"),p(),h(37,"input",19),u(38,"translate"),p(),w(39,Dt,3,3,"div",15),p(),d(40,"div",20)(41,"app-button",21),D(42),p()()()}if(r&2){let o,s,l=J(8),x=J(15);a("formGroup",t.form),n(),a("labelClass","form-label-title col-sm-2 mb-0")("gridClass","col-sm-10")("label","vehicles")("for","exclude_product")("required",!1),n(),L("noResultMessage",f(3,41,"no_data_found")),a("data",(o=f(4,43,t.vehicle$))!=null&&o.length?f(5,45,t.vehicle$):G(63,ot))("templates",l)("placeholder",f(6,47,"select_vehicle"))("customSearchEnabled",!0)("multiple",!0),n(7),a("label","Date")("for","sale_starts_at")("required",!1),n(3),a("autoClose","outside")("displayMonths",1)("dayTemplate",x),n(5),a("value",t.formatter.format(t.fromDate)),n(4),a("ngIf",(t.form==null||t.form.controls.sale_starts_at==null?null:t.form.controls.sale_starts_at.touched)&&(t.form==null||t.form.controls.sale_starts_at==null||t.form.controls.sale_starts_at.errors==null?null:t.form.controls.sale_starts_at.errors.required)),n(),a("label",f(23,49,"title"))("for","name")("required",!0),n(2),L("placeholder",f(25,51,"title")),n(2),a("ngIf",t.form.controls.title.touched&&(t.form.controls.title.errors==null?null:t.form.controls.title.errors.required)),n(),a("label","category")("for","style")("required",!0),n(),L("noResultMessage",f(29,53,"no_data_found")),a("data",t.variantStyle!=null&&t.variantStyle.length?t.variantStyle:G(64,ot))("placeholder",f(30,55,"select_category")),n(3),a("labelClass","form-label-title col-sm-2 mb-0")("gridClass","col-sm-10")("label","amount")("for","amount")("required",!0),n(3),b(" ",!((s=f(35,57,t.setting$))==null||s.general==null)&&s.general.default_currency.symbol?(s=f(36,59,t.setting$))==null||s.general==null?null:s.general.default_currency.symbol:"$"," "),n(3),L("placeholder",f(38,61,"enter_amount")),n(2),a("ngIf",(t.form==null||t.form.controls.amount==null?null:t.form.controls.amount.touched)&&(t.form==null||t.form.controls.amount==null||t.form.controls.amount.errors==null?null:t.form.controls.amount.errors.required)),n(2),a("id","attribute_btn"),n(),b(" ",t.type=="create"?"Save Attribute":"Update Attribute"," ")}},dependencies:[Ie,Oe,Ne,Me,Be,ke,je,Re,qe,ze,Ke,He,Fe,Z]});var E=R;m([O(te.vehicles)],E.prototype,"vehicle$",void 0);m([O(We.setting)],E.prototype,"setting$",void 0);var at=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=S({type:e,selectors:[["app-create-depense"]],decls:2,vars:2,consts:[[3,"title"],[3,"type"]],template:function(o,s){o&1&&(d(0,"app-page-wrapper",0),h(1,"app-form-depense",1),p()),o&2&&(a("title","add_depense"),n(),a("type","create"))},dependencies:[j,E]});let i=e;return i})();var st=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=S({type:e,selectors:[["app-edit-depense"]],decls:2,vars:2,consts:[[3,"title"],[3,"type"]],template:function(o,s){o&1&&(d(0,"app-page-wrapper",0),h(1,"app-form-depense",1),p()),o&2&&(a("title","edit_attribute"),n(),a("type","edit"))},dependencies:[j,E]});let i=e;return i})();var _t=[{path:"",component:Q,canActivate:[ee],data:{permission:"vehicle.index"}},{path:"create",component:at,canActivate:[ee],data:{permission:["vehicle.index","vehicle.create"]}},{path:"edit/:id",component:st,canActivate:[ee],data:{permission:["vehicle.index","vehicle.edit"]}}],lt=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Y({type:e}),e.\u0275inj=H({imports:[de.forChild(_t),de]});let i=e;return i})();var Fi=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Y({type:e}),e.\u0275inj=H({imports:[Ee,lt,Ze,$e.forFeature([te,c])]});let i=e;return i})();export{Fi as DepenseModule};
