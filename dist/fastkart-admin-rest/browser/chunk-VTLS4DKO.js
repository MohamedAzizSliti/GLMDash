import{$b as E,Fa as $,Zb as m,_b as R,a as s,ac as L,bc as j,cb as b,cc as A,dc as I,ec as k,fc as D,gc as B,hc as C,k as x,m as d,n as U,p as g}from"./chunk-X2K52VJG.js";import{$ as S,Bc as y,S as u,Y as w,h as p}from"./chunk-V4SAOAZP.js";import{a as l,b as h}from"./chunk-CWTPBX7D.js";var F=(()=>{let e=class e{constructor(t){this.http=t}getProducts(t){return this.http.get(`${s.URL}/product`,{params:t})}createProduct(t){return this.http.post(`${s.URL}/product`,t)}editProduct(t){return this.http.get(`${s.URL}/product/${t}`)}updateProduct(t,o){return this.http.put(`${s.URL}/product/${t}`,o)}updateProductStatus(t,o){return this.http.put(`${s.URL}/product/${t}/${o}`,{})}approveProductStatus(t,o){return this.http.put(`${s.URL}/product/approve/${t}/${o}`,{})}deleteProduct(t){return this.http.delete(`${s.URL}/product/${t}`)}deleteAllProduct(t){return this.http.post(`${s.URL}/product/deleteAll`,{ids:t})}replicateProduct(t){return this.http.post(`${s.URL}/product/replicate`,{ids:t})}importProduct(t){let o=new FormData;return Array.isArray(t)&&t.length&&t.forEach((c,i)=>{o.append("products",c,c.name)}),this.http.post(`${s.URL}/product/csv/import`,o)}exportProduct(){let t={};return this.http.post(`${s.URL}/product/csv/export`,t,{responseType:"blob"})}};e.\u0275fac=function(o){return new(o||e)(S(y))},e.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"});let v=e;return v})();var n,a=(n=class{constructor(e,r,t){this.store=e,this.notificationService=r,this.productService=t}static product(e){return e.product}static products(e){return e.product.data.filter(r=>r.id!==e.selectedProduct?.id).map(r=>({label:r?.name,value:r?.id,data:{type:r.type,name:r.name,slug:r.slug,stock_status:r.stock_status,image:r.product_thumbnail?r.product_thumbnail.original_url:"assets/images/product.png"}}))}static selectedProduct(e){return e.selectedProduct}static topSellingProducts(e){return e.topSellingProducts}getProducts(e,r){return this.productService.getProducts(r.payload).pipe(u({next:t=>{if(r?.payload.top_selling){let o=e.getState();e.patchState(h(l({},o),{topSellingProducts:t.data}))}else e.patchState({product:{data:t.data,total:t?.total?t?.total:t.data?.length}})},error:t=>{throw new Error(t?.error?.message)}}))}create(e,r){return this.productService.createProduct(r.payload).pipe(u({next:t=>{let o=e.getState();e.patchState(h(l({},o),{product:{data:[...o.product.data,t],total:o?.product.total+1}}))},complete:()=>{this.notificationService.showSuccess("Product Created Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}edit(e,{id:r}){return this.productService.editProduct(r).pipe(u({next:t=>{let o=e.getState();e.patchState(h(l({},o),{selectedProduct:t}))},error:t=>{throw new Error(t?.error?.message)}}))}update(e,{payload:r,id:t}){return this.productService.updateProduct(t,r).pipe(u({next:o=>{if(typeof o=="object"){let c=e.getState(),i=[...c.product.data],f=i.findIndex(P=>P.id===t);i[f]=o,e.patchState(h(l({},c),{product:{data:i,total:c.product.total}}))}},complete:()=>{this.notificationService.showSuccess("Product Updated Successfully")},error:o=>{throw new Error(o?.error?.message)}}))}updateStatus(e,{id:r,status:t}){return this.productService.updateProductStatus(r,t).pipe(u({next:o=>{if(typeof o=="object"){let c=e.getState(),i=[...c.product.data],f=i.findIndex(P=>P.id===r);i[f]=o,e.patchState(h(l({},c),{product:{data:i,total:c.product.total}}))}},complete:()=>{this.notificationService.showSuccess("Product Status Updated Successfully")},error:o=>{throw new Error(o?.error?.message)}}))}approveStatus(e,{id:r,status:t}){return this.productService.approveProductStatus(r,t).pipe(u({next:o=>{if(typeof o=="object"){let c=e.getState(),i=[...c.product.data],f=i.findIndex(P=>P.id===r);i[f]=o,e.patchState(h(l({},c),{product:{data:i,total:c.product.total}})),this.store.dispatch(new b("/product",o?.total_in_approved_products))}},complete:()=>{this.notificationService.showSuccess("Product Status Updated Successfully")},error:o=>{throw new Error(o?.error?.message)}}))}delete(e,{id:r}){return this.productService.deleteProduct(r).pipe(u({next:()=>{this.store.dispatch(new m({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("Product Deleted Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}deleteAll(e,{ids:r}){return this.productService.deleteAllProduct(r).pipe(u({next:()=>{this.store.dispatch(new m({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("Product Deleted Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}replicateProduct(e,{ids:r}){return this.productService.replicateProduct(r).pipe(u({next:()=>{this.store.dispatch(new m({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("Product Replicated Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}import(e,r){return this.productService.importProduct(r.payload).pipe(u({next:t=>{this.store.dispatch(new m({page:1,paginate:15}))},error:t=>{throw new Error(t?.error?.message)}}))}export(e,r){return this.productService.exportProduct().pipe(u({next:t=>{let o=new Blob([t],{type:"text/csv"}),c=window.URL.createObjectURL(o),i=document.createElement("a");i.href=c,i.download="products.csv",i.click(),window.URL.revokeObjectURL(c)},error:t=>{throw new Error(t?.error?.message)}}))}},n.\u0275fac=function(r){return new(r||n)(S(x),S($),S(F))},n.\u0275prov=w({token:n,factory:n.\u0275fac}),n);p([d(m)],a.prototype,"getProducts",null);p([d(R)],a.prototype,"create",null);p([d(E)],a.prototype,"edit",null);p([d(L)],a.prototype,"update",null);p([d(j)],a.prototype,"updateStatus",null);p([d(A)],a.prototype,"approveStatus",null);p([d(I)],a.prototype,"delete",null);p([d(k)],a.prototype,"deleteAll",null);p([d(D)],a.prototype,"replicateProduct",null);p([d(B)],a.prototype,"import",null);p([d(C)],a.prototype,"export",null);p([g()],a,"product",null);p([g()],a,"products",null);p([g()],a,"selectedProduct",null);p([g()],a,"topSellingProducts",null);a=p([U({name:"product",defaults:{product:{data:[],total:0},selectedProduct:null,topSellingProducts:[]}})],a);export{a};
