import{a as re}from"./chunk-VTLS4DKO.js";import{a as ne}from"./chunk-ISOQKGNC.js";import{A as Le,B as Ge,Dc as _t,E as f,Fa as pt,G as Oe,H as We,L as ze,O as He,Oa as st,P as Qe,Q as Je,T as Ke,Ua as mt,Zb as ge,a as q,aa as ie,ab as ct,ba as Xe,ca as Ye,da as Ze,ea as et,fb as dt,k as A,l as Me,lb as R,m as B,n as Ae,o as K,oa as tt,p as he,pa as it,qa as ot,qb as ut,ra as rt,rb as ft,sa as nt,ta as lt,ua as at,x as Re,y as Ue,z as S}from"./chunk-X2K52VJG.js";import{$,Aa as ue,Bc as $e,C as be,Ca as n,Da as w,Db as Fe,Eb as Te,Fb as Ne,Ia as we,Ib as M,Nb as m,Nc as Pe,Ob as c,P as xe,Pc as te,Q as Se,Qa as _,Qc as je,Rb as J,S as T,Sa as a,Sc as _e,Ua as Q,Vc as oe,Wa as fe,Y,Z,ab as p,bb as l,bc as qe,c as de,cb as d,da as N,ea as ee,gb as P,h as C,j as Ce,jb as I,kb as h,kc as Be,la as y,ma as b,nb as E,nc as Ve,q as ye,rb as Ie,sb as Ee,tb as De,ub as D,vc as ke,wb as u,xb as j,yb as g}from"./chunk-V4SAOAZP.js";import{a as z,b as H}from"./chunk-CWTPBX7D.js";var U=(()=>{let e=class e{constructor(i){this.payload=i}};e.type="[Coupon] Get";let o=e;return o})(),le=(()=>{let e=class e{constructor(i){this.payload=i}};e.type="[Coupon] Create";let o=e;return o})(),ae=(()=>{let e=class e{constructor(i){this.id=i}};e.type="[Coupon] Edit";let o=e;return o})(),pe=(()=>{let e=class e{constructor(i,r){this.payload=i,this.id=r}};e.type="[Coupon] Update";let o=e;return o})(),se=(()=>{let e=class e{constructor(i,r){this.id=i,this.status=r}};e.type="[Coupon] Update Status";let o=e;return o})(),me=(()=>{let e=class e{constructor(i){this.id=i}};e.type="[Coupon] Delete";let o=e;return o})(),ce=(()=>{let e=class e{constructor(i){this.ids=i}};e.type="[Coupon] Delete All";let o=e;return o})();var ht=(()=>{let e=class e{constructor(i){this.http=i}getCoupons(i){return this.http.get(`${q.URL}/coupon`,{params:i})}createCoupon(i){return this.http.post(`${q.URL}/coupon`,i)}editCoupon(i){return this.http.get(`${q.URL}/coupon/${i}`)}updateCoupon(i,r){return this.http.put(`${q.URL}/coupon/${i}`,r)}updateCouponStatus(i,r){return this.http.put(`${q.URL}/coupon/${i}/${r}`,{})}deleteCoupon(i){return this.http.delete(`${q.URL}/coupon/${i}`)}deleteAllCoupon(i){return this.http.post(`${q.URL}/coupon/deleteAll`,{ids:i})}};e.\u0275fac=function(r){return new(r||e)($($e))},e.\u0275prov=Y({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var F,v=(F=class{constructor(e,t,i){this.store=e,this.notificationService=t,this.couponService=i}static coupon(e){return e.coupon}static selectedCoupon(e){return e.selectedCoupon}getCoupons(e,t){return this.couponService.getCoupons(t.payload).pipe(T({next:i=>{e.patchState({coupon:{data:i.data,total:i?.total?i?.total:i.data?.length}})},error:i=>{throw new Error(i?.error?.message)}}))}create(e,t){return this.couponService.createCoupon(t.payload).pipe(T({next:i=>{let r=e.getState();e.patchState(H(z({},r),{coupon:{data:[...r.coupon.data,i],total:r?.coupon.total+1}}))},complete:()=>{this.notificationService.showSuccess("Coupon Created Successfully")},error:i=>{throw new Error(i?.error?.message)}}))}edit(e,{id:t}){return this.couponService.editCoupon(t).pipe(T({next:i=>{let r=e.getState();e.patchState(H(z({},r),{selectedCoupon:i}))},error:i=>{throw new Error(i?.error?.message)}}))}update(e,{payload:t,id:i}){return this.couponService.updateCoupon(i,t).pipe(T({next:r=>{if(typeof r=="object"){let s=e.getState(),x=[...s.coupon.data],O=x.findIndex(W=>W.id===i);x[O]=r,e.patchState(H(z({},s),{coupon:{data:x,total:s.coupon.total}}))}},complete:()=>{this.notificationService.showSuccess("Coupon Updated Successfully")},error:r=>{throw new Error(r?.error?.message)}}))}updateStatus(e,{id:t,status:i}){return this.couponService.updateCouponStatus(t,i).pipe(T({next:r=>{if(typeof r=="object"){let s=e.getState(),x=[...s.coupon.data],O=x.findIndex(W=>W.id===t);x[O]=r,e.patchState(H(z({},s),{coupon:{data:x,total:s.coupon.total}}))}},complete:()=>{this.notificationService.showSuccess("Coupon Status Updated Successfully")},error:r=>{throw new Error(r?.error?.message)}}))}delete(e,{id:t}){return this.couponService.deleteCoupon(t).pipe(T({next:()=>{this.store.dispatch(new U({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("Coupon Deleted Successfully")},error:i=>{throw new Error(i?.error?.message)}}))}deleteAll(e,{ids:t}){return this.couponService.deleteAllCoupon(t).pipe(T({next:()=>{this.store.dispatch(new U({page:1,paginate:15}))},complete:()=>{this.notificationService.showSuccess("Coupon Deleted Successfully")},error:i=>{throw new Error(i?.error?.message)}}))}},F.\u0275fac=function(t){return new(t||F)($(A),$(pt),$(ht))},F.\u0275prov=Y({token:F,factory:F.\u0275fac}),F);C([B(U)],v.prototype,"getCoupons",null);C([B(le)],v.prototype,"create",null);C([B(ae)],v.prototype,"edit",null);C([B(pe)],v.prototype,"update",null);C([B(se)],v.prototype,"updateStatus",null);C([B(me)],v.prototype,"delete",null);C([B(ce)],v.prototype,"deleteAll",null);C([he()],v,"coupon",null);C([he()],v,"selectedCoupon",null);v=C([Ae({name:"coupon",defaults:{coupon:{data:[],total:0},selectedCoupon:null}})],v);var Dt=()=>["/coupon/create"];function Ft(o,e){o&1&&(p(0,"div",3)(1,"a",4),d(2,"i",5),u(3),m(4,"translate"),l()()),o&2&&(n(),a("routerLink",M(4,Dt)),n(2),g(" ",c(4,2,"add_coupon")," "))}var L=class L{constructor(e,t){this.store=e,this.router=t,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"code",dataField:"code",sortable:!0,sort_direction:"desc"},{title:"created_at",dataField:"created_at",type:"date",sortable:!0,sort_direction:"desc"},{title:"status",dataField:"status",type:"switch"}],rowActions:[{label:"Edit",actionToPerform:"edit",icon:"ri-pencil-line",permission:"coupon.edit"},{label:"Delete",actionToPerform:"delete",icon:"ri-delete-bin-line",permission:"coupon.destroy"}],data:[],total:0}}ngOnInit(){this.coupon$.subscribe(e=>{this.tableConfig.data=e?e?.data:[],this.tableConfig.total=e?e?.total:0})}onTableChange(e){this.store.dispatch(new U(e)).subscribe()}onActionClicked(e){e.actionToPerform=="edit"?this.edit(e.data):e.actionToPerform=="status"?this.status(e.data):e.actionToPerform=="delete"?this.delete(e.data):e.actionToPerform=="deleteAll"&&this.deleteAll(e.data)}edit(e){this.router.navigateByUrl(`/coupon/edit/${e.id}`)}status(e){this.store.dispatch(new se(e.id,e.status))}delete(e){this.store.dispatch(new me(e.id))}deleteAll(e){this.store.dispatch(new ce(e))}};L.\u0275fac=function(t){return new(t||L)(w(A),w(te))},L.\u0275cmp=N({type:L,selectors:[["app-coupon"]],decls:3,vars:5,consts:[[3,"gridClass","title"],["button","",4,"hasPermission"],[3,"tableChanged","rowClicked","action","tableConfig","hasCheckbox"],["button",""],[1,"align-items-center","btn","btn-theme","d-flex",3,"routerLink"],[1,"ri-add-line"]],template:function(t,i){t&1&&(p(0,"app-page-wrapper",0),_(1,Ft,5,5,"div",1),p(2,"app-table",2),I("tableChanged",function(s){return i.onTableChange(s)})("rowClicked",function(s){return i.edit(s)})("action",function(s){return i.onActionClicked(s)}),l()()),t&2&&(a("gridClass","col-sm-12")("title","coupons"),n(),a("hasPermission","coupon.create"),n(),a("tableConfig",i.tableConfig)("hasCheckbox",!0))},dependencies:[je,ut,R,ct,oe]});var X=L;C([K(v.coupon)],X.prototype,"coupon$",void 0);var Tt=["nav"],ve=()=>[];function Nt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"title_is_required")," "))}function qt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"description_is_required")," "))}function Bt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"code_is_required")," "))}function Vt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"type_is_required")," "))}function kt(o,e){if(o&1&&(p(0,"div",40)(1,"span",41),u(2),m(3,"async"),m(4,"async"),l(),d(5,"input",42),m(6,"translate"),l()),o&2){let t,i=h(3);n(2),g(" ",!((t=c(3,2,i.setting$))==null||t.general==null)&&t.general.default_currency.symbol?(t=c(4,4,i.setting$))==null||t.general==null?null:t.general.default_currency.symbol:"$"," "),n(3),E("placeholder",c(6,6,"enter_amount"))}}function $t(o,e){o&1&&(p(0,"div",40),d(1,"input",43),m(2,"translate"),p(3,"span",41),u(4,"%"),l()()),o&2&&(n(),E("placeholder",c(2,1,"enter_amount")))}function Pt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"amount_is_required")," "))}function jt(o,e){if(o&1&&(p(0,"app-form-fields",24),_(1,kt,7,8,"div",39)(2,$t,5,3,"div",39)(3,Pt,3,3,"div",26),l()),o&2){let t=h(2);a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","amount")("for","amount")("required",!0),n(),a("ngIf",t.form.get("type").value!=="percentage"),n(),a("ngIf",t.form.get("type").value==="percentage"),n(),a("ngIf",(t.form==null||t.form.controls.amount==null?null:t.form.controls.amount.touched)&&(t.form==null||t.form.controls.amount==null||t.form.controls.amount.errors==null?null:t.form.controls.amount.errors.required))}}function Mt(o,e){if(o&1){let t=P();p(0,"span",51),I("mouseenter",function(){let r=y(t).$implicit,s=h(3);return b(s.hoveredDate=r)})("mouseleave",function(){y(t);let r=h(3);return b(r.hoveredDate=null)}),u(1),l()}if(o&2){let t=e.$implicit,i=e.focused,r=h(3);Q("focused",i)("range",r.isRange(t))("faded",r.isHovered(t)||r.isInside(t)),n(),g(" ",t.day," ")}}function At(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"start_date_is_required")," "))}function Rt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"end_date_is_required")," "))}function Ut(o,e){if(o&1){let t=P();p(0,"div")(1,"app-form-fields",24)(2,"div",44)(3,"div",40)(4,"input",45,1),I("dateSelect",function(r){y(t);let s=h(2);return b(s.onDateSelection(r))}),l(),_(6,Mt,2,7,"ng-template",null,2,J),l()(),p(8,"div",46)(9,"input",47,3),I("input",function(){y(t);let r=D(10),s=h(2);return b(s.fromDate=s.validateInput(s.fromDate,r.value))}),l(),p(11,"button",48),I("click",function(){y(t);let r=D(5);return b(r.toggle())}),d(12,"i",49),l()(),_(13,At,3,3,"div",26),l(),p(14,"app-form-fields",24)(15,"div",46)(16,"input",50,4),I("input",function(){y(t);let r=D(17),s=h(2);return b(s.toDate=s.validateInput(s.toDate,r.value))}),l(),p(18,"button",48),I("click",function(){y(t);let r=D(5);return b(r.toggle())}),d(19,"i",49),l()(),_(20,Rt,3,3,"div",26),l()()}if(o&2){let t=D(7),i=h(2);n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","start_date")("for","start_date")("required",!0),n(3),a("autoClose","outside")("displayMonths",2)("dayTemplate",t)("startDate",i.fromDate),n(5),a("value",i.formatter.format(i.fromDate)),n(4),a("ngIf",(i.form==null||i.form.controls.start_date==null?null:i.form.controls.start_date.touched)&&(i.form==null||i.form.controls.start_date==null||i.form.controls.start_date.errors==null?null:i.form.controls.start_date.errors.required)),n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","end_date")("for","end_date")("required",!0),n(2),a("value",i.formatter.format(i.toDate)),n(4),a("ngIf",(i.form==null||i.form.controls.end_date==null?null:i.form.controls.end_date.touched)&&(i.form==null||i.form.controls.end_date==null||i.form.controls.end_date.errors==null?null:i.form.controls.end_date.errors.required))}}function Lt(o,e){if(o&1&&(p(0,"div",23)(1,"app-form-fields",24),d(2,"input",25),m(3,"translate"),_(4,Nt,3,3,"div",26),l(),p(5,"app-form-fields",24),d(6,"textarea",27),m(7,"translate"),_(8,qt,3,3,"div",26),l(),p(9,"app-form-fields",24),d(10,"input",28),m(11,"translate"),_(12,Bt,3,3,"div",26),l(),p(13,"app-form-fields",24),d(14,"select2",29),m(15,"translate"),_(16,Vt,3,3,"div",26),l(),_(17,jt,4,8,"app-form-fields",30),p(18,"app-form-fields",24)(19,"div",31)(20,"label",32),d(21,"input",33)(22,"span",34),l()()(),_(23,Ut,21,18,"div",35),p(24,"app-form-fields",24)(25,"div",31)(26,"label",32),d(27,"input",36)(28,"span",34),l()()(),p(29,"app-form-fields",24)(30,"div",31)(31,"label",32),d(32,"input",37)(33,"span",34),l()()()()),o&2){let t=h();n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","title")("for","title")("required",!0),n(),E("placeholder",c(3,46,"enter_coupon_title")),n(2),a("ngIf",(t.form==null||t.form.controls.title==null?null:t.form.controls.title.touched)&&(t.form.controls.title==null||t.form.controls.title.errors==null?null:t.form.controls.title.errors.required)),n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","description")("for","description")("required",!0),n(),E("placeholder",c(7,48,"enter_coupon_description")),n(2),a("ngIf",(t.form==null||t.form.controls.description==null?null:t.form.controls.description.touched)&&(t.form.controls.description==null||t.form.controls.description.errors==null?null:t.form.controls.description.errors.required)),n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","code")("for","code")("required",!0),n(),E("placeholder",c(11,50,"enter_coupon_code")),n(2),a("ngIf",(t.form==null||t.form.controls.code==null?null:t.form.controls.code.touched)&&(t.form.controls.code==null||t.form.controls.code.errors==null?null:t.form.controls.code.errors.required)),n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","type")("for","type")("required",!0),n(),a("placeholder",c(15,52,"select_type"))("data",t.couponType!=null&&t.couponType.length?t.couponType:M(54,ve)),n(2),a("ngIf",(t.form==null||t.form.controls.type==null?null:t.form.controls.type.touched)&&(t.form==null||t.form.controls.type==null||t.form.controls.type.errors==null?null:t.form.controls.type.errors.required)),n(),a("ngIf",t.form.get("type").value!=="free_shipping"),n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","is_expired")("for","is_expired")("required",!0),n(5),a("ngIf",t.form.controls.is_expired.value),n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","is_first_order")("for","is_first_order")("required",!1),n(5),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","status")("for","status")("required",!1)}}function Gt(o,e){if(o&1&&(p(0,"div",58),d(1,"img",59),l(),u(2)),o&2){let t=e.data;n(),fe("img-fluid selection-image"),a("src",t.image,ue),n(),g(" ",t.name," ")}}function Ot(o,e){if(o&1){let t=P();p(0,"app-form-fields",24)(1,"select2",57),m(2,"translate"),m(3,"async"),m(4,"async"),m(5,"translate"),I("close",function(r){y(t);let s=h(2);return b(s.productDropdown(r))})("search",function(r){y(t);let s=h(2);return b(s.searchProduct(r))}),_(6,Gt,3,4,"ng-template",null,6,J),l()()}if(o&2){let t,i=D(7),r=h(2);a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","exclude_products")("for","exclude_product")("required",!1),n(),E("noResultMessage",c(2,11,"no_data_found")),a("data",(t=c(3,13,r.product$))!=null&&t.length?c(4,15,r.product$):M(19,ve))("templates",i)("placeholder",c(5,17,"select_product"))("customSearchEnabled",!0)("multiple",!0)}}function Wt(o,e){if(o&1&&(p(0,"div",58),d(1,"img",59),l(),u(2)),o&2){let t=e.data;n(),fe("img-fluid selection-image"),a("src",t.image,ue),n(),g(" ",t.name," ")}}function zt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"products_is_required")," "))}function Ht(o,e){if(o&1){let t=P();p(0,"app-form-fields",24)(1,"select2",60),m(2,"translate"),m(3,"async"),m(4,"async"),m(5,"translate"),I("close",function(r){y(t);let s=h(2);return b(s.productDropdown(r))})("search",function(r){y(t);let s=h(2);return b(s.searchProduct(r))}),l(),_(6,Wt,3,4,"ng-template",null,6,J)(8,zt,3,3,"div",26),l()}if(o&2){let t,i=D(7),r=h(2);a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","include_products")("for","include_product")("required",!0),n(),E("noResultMessage",c(2,12,"no_data_found")),a("data",(t=c(3,14,r.product$))!=null&&t.length?c(4,16,r.product$):M(20,ve))("templates",i)("placeholder",c(5,18,"select_product"))("customSearchEnabled",!0)("multiple",!0),n(7),a("ngIf",(r.form==null||r.form.controls.products==null?null:r.form.controls.products.touched)&&(r.form==null||r.form.controls.products==null||r.form.controls.products.errors==null?null:r.form.controls.products.errors.required))}}function Qt(o,e){o&1&&(p(0,"div",38),u(1),m(2,"translate"),l()),o&2&&(n(),g(" ",c(2,1,"min_spend_is_required")," "))}function Jt(o,e){if(o&1&&(p(0,"div",52)(1,"app-form-fields",24)(2,"div",31)(3,"label",32),d(4,"input",53)(5,"span",34),l()()(),_(6,Ot,8,20,"app-form-fields",54)(7,Ht,9,21,"ng-template",null,5,J),p(9,"app-form-fields",24)(10,"div",40)(11,"span",41),u(12),m(13,"async"),m(14,"async"),l(),d(15,"input",55),m(16,"translate"),l(),p(17,"p",56),u(18),l(),_(19,Qt,3,3,"div",26),l()()),o&2){let t,i=D(8),r=h();n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","apply_to_all_products")("for","is_apply_all")("required",!1),n(5),a("ngIf",r.form==null||r.form.controls.is_apply_all==null?null:r.form.controls.is_apply_all.value)("ngIfElse",i),n(3),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","minimum_spend")("for","min_spend")("required",!0),n(3),g(" ",!((t=c(13,16,r.setting$))==null||t.general==null||t.general.default_currency==null)&&t.general.default_currency.symbol?(t=c(14,18,r.setting$))==null||t.general==null||t.general.default_currency==null?null:t.general.default_currency.symbol:"$"," "),n(3),E("placeholder",c(16,20,"enter_minimum_spend")),n(3),j("*Define the minimum order value needed to utilize the coupon."),n(),a("ngIf",(r.form==null||r.form.controls.min_spend==null?null:r.form.controls.min_spend.touched)&&(r.form==null||r.form.controls.min_spend==null||r.form.controls.min_spend.errors==null?null:r.form.controls.min_spend.errors.required))}}function Kt(o,e){o&1&&(p(0,"app-form-fields",24),d(1,"input",63),m(2,"translate"),p(3,"p",56),u(4),l()()),o&2&&(a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","usage_per_coupon")("for","usage_per_coupon")("required",!1),n(),E("placeholder",c(2,7,"enter_value")),n(3),j("*Specify the maximum number of times a single coupon can be utilized."))}function Xt(o,e){o&1&&(p(0,"app-form-fields",24),d(1,"input",64),m(2,"translate"),p(3,"p",56),u(4),l()()),o&2&&(a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","usage_per_customer")("for","usage_per_customer")("required",!1),n(),E("placeholder",c(2,7,"enter_value")),n(3),j("*Specify the maximum number of times a single customer can utilize the coupon."))}function Yt(o,e){if(o&1&&(p(0,"div",61)(1,"app-form-fields",24)(2,"div",31)(3,"label",32),d(4,"input",62)(5,"span",34),l()()(),_(6,Kt,5,9,"app-form-fields",30)(7,Xt,5,9,"app-form-fields",30),l()),o&2){let t=h();n(),a("labelClass","form-label-title col-sm-3 mb-0")("gridClass","col-sm-9")("label","is_unlimited")("for","is_unlimited")("required",!0),n(5),a("ngIf",!(!(t.form==null||t.form.controls.is_unlimited==null)&&t.form.controls.is_unlimited.value)),n(),a("ngIf",!(!(t.form==null||t.form.controls.is_unlimited==null)&&t.form.controls.is_unlimited.value))}}function Ct(o){return new ie(o.year,o.month,o.day)}var G=class G{constructor(e,t,i,r,s,x,O,W){this.store=e,this.route=t,this.router=i,this.formBuilder=r,this.calendar=s,this.formatter=x,this.renderer=O,this.document=W,this.active="general",this.hoveredDate=null,this.search=new de,this.couponType=[{value:"percentage",label:"Percentage"},{value:"free_shipping",label:"Free Shipping"},{value:"fixed",label:"Fixed"}],this.destroy$=new de,this.form=this.formBuilder.group({title:new f("",[S.required]),description:new f("",[S.required]),code:new f("",[S.required]),type:new f("",[S.required]),amount:new f(""),start_date:new f("",[S.required]),end_date:new f("",[S.required]),is_expired:new f(1),is_first_order:new f,status:new f(1),is_apply_all:new f(0),products:new f("",[S.required]),exclude_products:new f,min_spend:new f("",[S.required]),is_unlimited:new f(0),usage_per_coupon:new f,usage_per_customer:new f})}ngOnInit(){this.store.dispatch(new ge({status:1,is_approved:1,paginate:15})),this.route.params.pipe(xe(e=>e.id?this.store.dispatch(new ae(e.id)).pipe(ye(()=>this.store.select(v.selectedCoupon))):Ce()),Se(this.destroy$)).subscribe(e=>{this.data=e,this.id=e?.id,this.fromDate=e?.start_date?Ct(this.formatter.parse(e.start_date)):null,this.toDate=e?.end_date?Ct(this.formatter.parse(e.end_date)):null,this.form.patchValue({title:e?.title,description:e?.description,code:e?.code,type:e?.type,amount:e?.amount,start_date:e?.start_date,end_date:e?.end_date,is_expired:e?.is_expired,is_first_order:e?.is_first_order,is_apply_all:Number(e?.is_apply_all),exclude_products:e?.exclude_products?.map(t=>t.id),products:e?.products?.map(t=>t.id),min_spend:e?.min_spend,is_unlimited:e?.is_unlimited,usage_per_coupon:e?.usage_per_coupon,usage_per_customer:e?.usage_per_customer,status:e?.status})}),this.search.pipe(be(300)).subscribe(e=>{this.store.dispatch(new ge({status:1,is_approved:1,paginate:15,search:e})),this.renderer.addClass(this.document.body,"loader-none")}),this.form.controls.is_expired.valueChanges.subscribe(e=>{e?(this.form.setControl("start_date",new f(this.data?this.data?.start_date:"",[S.required])),this.form.setControl("end_date",new f(this.data?this.data?.end_date:"",[S.required]))):(this.form.removeControl("start_date"),this.form.removeControl("end_date"))}),this.form.controls.is_apply_all.valueChanges.subscribe(e=>{e?(this.form.removeControl("products"),this.form.setControl("exclude_products",new f(this.data?.exclude_products?.length?this.data?.exclude_products?.map(t=>t.id):null))):(this.form.removeControl("exclude_products"),this.form.setControl("products",new f(this.data?.products?.map(t=>t.id),[S.required])))}),this.form.controls.is_unlimited.valueChanges.subscribe(e=>{e?(this.form.removeControl("usage_per_coupon"),this.form.removeControl("usage_per_customer")):(this.form.setControl("usage_per_coupon",new f(this.data?.usage_per_coupon)),this.form.setControl("usage_per_customer",new f(this.data?.usage_per_customer)))}),this.form.controls.type.valueChanges.subscribe(e=>{e==="free_shipping"?this.form.removeControl("amount"):this.form.setControl("amount",new f(this.data?.amount,[S.required]))})}productDropdown(e){e.innerSearchText&&this.search.next("")}searchProduct(e){this.search.next(e.search)}onDateSelection(e){!this.fromDate&&!this.toDate?this.fromDate=e:this.fromDate&&!this.toDate&&e&&e.after(this.fromDate)?this.toDate=e:(this.toDate=null,this.fromDate=e),this.fromDate&&this.form.controls.start_date.setValue(`${this.fromDate.year}-${this.fromDate.month}-${this.fromDate.day}`),this.toDate&&this.form.controls.end_date.setValue(`${this.toDate?.year}-${this.toDate?.month}-${this.toDate?.day}`)}isHovered(e){return this.fromDate&&!this.toDate&&this.hoveredDate&&e.after(this.fromDate)&&e.before(this.hoveredDate)}isInside(e){return this.toDate&&e.after(this.fromDate)&&e.before(this.toDate)}isRange(e){return e.equals(this.fromDate)||this.toDate&&e.equals(this.toDate)||this.isInside(e)||this.isHovered(e)}validateInput(e,t){let i=this.formatter.parse(t);return i&&this.calendar.isValid(ie.from(i))?ie.from(i):e}submit(){this.form.markAllAsTouched();let e=new le(this.form.value);if(this.type=="edit"&&this.id&&(e=new pe(this.form.value,this.id)),this.form.valid)this.store.dispatch(e).subscribe({complete:()=>{this.router.navigateByUrl("/coupon")}}),this.tabError=null;else{let t=Object?.keys(this.form?.controls).find(r=>this.form.controls[r].invalid),i=document.querySelector(`#${t}`)?.closest("div.tab")?.getAttribute("tab");i&&(this.nav.select(i),this.tabError=i)}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};G.\u0275fac=function(t){return new(t||G)(w(A),w(Pe),w(te),w(Ke),w(Xe),w(Ye),w(we),w(qe))},G.\u0275cmp=N({type:G,selectors:[["app-form-coupon"]],viewQuery:function(t,i){if(t&1&&Ie(Tt,5),t&2){let r;Ee(r=De())&&(i.nav=r.first)}},inputs:{type:"type"},decls:29,vars:22,consts:[["nav","ngbNav"],["datepicker","ngbDatepicker"],["t",""],["dpFromDate",""],["dpToDate",""],["includeProduct",""],["template",""],[1,"theme-form","theme-form-2","mega-form",3,"ngSubmit","formGroup"],[1,"vertical-tabs"],[1,"row"],[1,"col-xl-3","col-lg-4"],["ngbNav","","orientation","vertical",1,"nav-pills","coupon-tab",3,"activeIdChange","activeId"],["ngbNavItem","general","id","general"],["ngbNavLink",""],[1,"ri-settings-line"],["ngbNavContent",""],["ngbNavItem","restriction","id","restriction"],[1,"ri-close-circle-line"],["ngbNavItem","usage","id","usage"],[1,"ri-pie-chart-line"],[1,"col-xl-7","col-lg-8"],[3,"ngbNavOutlet"],[3,"id"],["tab","general",1,"tab"],[3,"labelClass","gridClass","label","for","required"],["id","title","type","text","formControlName","title",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngIf"],["id","description","type","text","formControlName","description",1,"form-control",3,"placeholder"],["id","code","type","text","formControlName","code",1,"form-control",3,"placeholder"],["id","type","formControlName","type",1,"custom-select",3,"placeholder","data"],[3,"labelClass","gridClass","label","for","required",4,"ngIf"],[1,"form-check","form-switch","ps-0"],[1,"switch"],["type","checkbox","id","is_expired","formControlName","is_expired"],[1,"switch-state"],[4,"ngIf"],["type","checkbox","id","is_first_order","formControlName","is_first_order"],["type","checkbox","id","status","formControlName","status"],[1,"invalid-feedback"],["class","input-group",4,"ngIf"],[1,"input-group"],[1,"input-group-text"],["type","number","name","amount","formControlName","amount",1,"form-control",3,"placeholder"],["type","number","min","0","max","100","oninput","if (value > 100) value = 100; if (value < 0) value = 0;","name","amount","formControlName","amount",1,"form-control",3,"placeholder"],[1,"dp-hidden","position-absolute","custom-dp-dropdown"],["name","datepicker","ngbDatepicker","","outsideDays","hidden","id","start_date","tabindex","-1","readonly","",1,"form-control",3,"dateSelect","autoClose","displayMonths","dayTemplate","startDate"],[1,"input-group","custom-dt-picker"],["placeholder","yyyy-mm-dd","name","dpFromDate","id","end_date","readonly","",1,"form-control",3,"input","value"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"ri-calendar-line"],["placeholder","yyyy-mm-dd","name","dpToDate","readonly","",1,"form-control",3,"input","value"],[1,"custom-day",3,"mouseenter","mouseleave"],["tab","restriction",1,"tab"],["type","checkbox","id","is_apply_all","formControlName","is_apply_all"],[3,"labelClass","gridClass","label","for","required",4,"ngIf","ngIfElse"],["type","number","id","min_spend","name","min_spend","formControlName","min_spend",1,"form-control",3,"placeholder"],[1,"help-text"],["formControlName","exclude_products","id","exclude_product",1,"custom-select",3,"close","search","data","templates","placeholder","noResultMessage","customSearchEnabled","multiple"],[1,"image"],[3,"src"],["formControlName","products","id","products",1,"custom-select",3,"close","search","data","templates","placeholder","noResultMessage","customSearchEnabled","multiple"],["tab","usage",1,"tab"],["type","checkbox","id","is_unlimited","formControlName","is_unlimited"],["type","number","id","usage_per_coupon","name","usage_per_coupon","formControlName","usage_per_coupon",1,"form-control",3,"placeholder"],["type","number","id","usage_per_customer","name","usage_per_customer","formControlName","usage_per_customer",1,"form-control",3,"placeholder"]],template:function(t,i){if(t&1){let r=P();p(0,"form",7),I("ngSubmit",function(){return y(r),b(i.submit())}),p(1,"div",8)(2,"div",9)(3,"div",10)(4,"ul",11,0),Ne("activeIdChange",function(x){return y(r),Te(i.active,x)||(i.active=x),b(x)}),p(6,"li",12)(7,"a",13),d(8,"i",14),u(9),m(10,"translate"),l(),_(11,Lt,34,55,"ng-template",15),l(),p(12,"li",16)(13,"a",13),d(14,"i",17),u(15),m(16,"translate"),l(),_(17,Jt,20,22,"ng-template",15),l(),p(18,"li",18)(19,"a",13),d(20,"i",19),u(21),m(22,"translate"),l(),_(23,Yt,8,7,"ng-template",15),l()()(),p(24,"div",20),d(25,"div",21),l()(),p(26,"app-button",22),u(27),m(28,"translate"),l()()()}if(t&2){let r=D(5);a("formGroup",i.form),n(4),Fe("activeId",i.active),n(2),Q("is-invalid",i.tabError=="general"),n(3),j(c(10,14,"general")),n(3),Q("is-invalid",i.tabError=="restriction"),n(3),g(" ",c(16,16,"restriction"),""),n(3),Q("is-invalid",i.tabError=="usage"),n(3),j(c(22,18,"usage")),n(4),a("ngbNavOutlet",r),n(),a("id","coupon_btn"),n(),g(" ",c(28,20,i.type=="create"?"save_coupon":"update_coupon")," ")}},dependencies:[Be,Ze,tt,rt,ot,it,lt,nt,at,Oe,Ue,We,Re,Le,Ge,Je,Qe,ze,He,dt,ft,mt,Ve,oe]});var V=G;C([K(re.products)],V.prototype,"product$",void 0);C([K(st.setting)],V.prototype,"setting$",void 0);var bt=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=N({type:e,selectors:[["app-create-coupon"]],decls:2,vars:3,consts:[[3,"gridClass","title"],[3,"type"]],template:function(r,s){r&1&&(p(0,"app-page-wrapper",0),d(1,"app-form-coupon",1),l()),r&2&&(a("gridClass","col-sm-12")("title","create_coupon"),n(),a("type","create"))},dependencies:[R,V]});let o=e;return o})();var xt=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=N({type:e,selectors:[["app-edit-coupon"]],decls:2,vars:3,consts:[[3,"gridClass","title"],[3,"type"]],template:function(r,s){r&1&&(p(0,"app-page-wrapper",0),d(1,"app-form-coupon",1),l()),r&2&&(a("gridClass","col-sm-12")("title","edit_coupon"),n(),a("type","edit"))},dependencies:[R,V]});let o=e;return o})();var Zt=[{path:"",component:X,canActivate:[ne],data:{permission:"coupon.index"}},{path:"create",component:bt,canActivate:[ne],data:{permission:["coupon.index","coupon.create"]}},{path:"edit/:id",component:xt,canActivate:[ne],data:{permission:["coupon.index","coupon.edit"]}}],St=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=ee({type:e}),e.\u0275inj=Z({imports:[_e.forChild(Zt),_e]});let o=e;return o})();var ro=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=ee({type:e}),e.\u0275inj=Z({imports:[ke,St,et,_t,Me.forFeature([v,re])]});let o=e;return o})();export{ro as CouponModule};
