import{a as N}from"./chunk-HCMAZYZ2.js";import"./chunk-K5FNPDN3.js";import{a as Ct,m as j}from"./chunk-O55BQOZL.js";import{a as bt}from"./chunk-ISOQKGNC.js";import{A as rt,B as nt,Dc as St,E as S,Fa as ht,G as st,Ga as ft,L as lt,O as pt,T as ct,a as Z,aa as mt,ca as dt,fb as gt,k as tt,l as et,lb as vt,m as it,n as ot,o as y,p as at,qb as yt,z as B}from"./chunk-X2K52VJG.js";import{$ as v,Bc as Y,Ca as r,Da as h,Ia as q,Ib as $,Nb as l,Ob as p,Qa as H,S as E,Sa as n,Sc as R,Vc as ut,Xa as U,Y as I,Z as D,ab as f,bb as _,bc as z,c as A,cb as T,da as P,ea as w,gb as k,h as s,jb as L,kb as W,kc as J,la as Q,ma as O,nc as K,rb as V,sb as F,tb as M,vc as X}from"./chunk-V4SAOAZP.js";import"./chunk-CWTPBX7D.js";var u=(()=>{let t=class t{constructor(e){this.payload=e}};t.type="[Stop] Stop Get";let o=t;return o})();var It=(()=>{let t=class t{constructor(e){this.http=e}getStops(e){return this.http.get(`${Z.URL}/traccar/reports/stops`,{params:e})}};t.\u0275fac=function(a){return new(a||t)(v(Y))},t.\u0275prov=I({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var c,m=(c=class{constructor(t,i){this.notificationService=t,this.stopService=i}static stop(t){return t.stop}getStops(t,{payload:i}){return this.stopService.getStops(i).pipe(E({next:e=>{console.log("/***** The Value result result ****/"),console.log(e),t.patchState({stop:{data:e.data,total:e?.total?e?.total:e.data?.length}})},error:e=>{throw new Error(e?.error?.message)}}))}},c.\u0275fac=function(i){return new(i||c)(v(ht),v(It))},c.\u0275prov=I({token:c,factory:c.\u0275fac}),c);s([it(u)],m.prototype,"getStops",null);s([at()],m,"stop",null);m=s([ot({name:"stop",defaults:{stop:{data:[],total:0}}})],m);var jt=["tableTable"],xt=["confirmationModal"],wt=()=>[];function Tt(o,t){if(o&1&&(f(0,"div",7)(1,"form",3)(2,"app-page-wrapper",4),T(3,"select2",8),l(4,"async"),l(5,"async"),l(6,"translate"),_()()()),o&2){let i,e=W();r(),n("formGroup",e.form),r(),n("gridClass","col-sm-12")("title","select_consumer"),r(),n("data",(i=p(4,5,e.users$))!=null&&i.length?p(5,7,e.users$):$(11,wt))("placeholder",p(6,9,"select_consumer"))}}function Dt(o){return new mt(o.year,o.month,o.day)}var g=class g{ngOnInit(){this.store.dispatch(new Ct({status:1}));let t=this.gettodayRange();this.todayStartAt=t.start,this.todayEndAt=t.end,setTimeout(()=>{this.tableMain.onDateSelection(Dt(this.formatter.parse(t.start))),this.tableMain.onDateSelection(Dt(this.formatter.parse(t.end)))}),this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.vehicle$.subscribe(i=>{this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.selecteVehicle?setTimeout(()=>{this.form.controls.vehicle_id.setValue(parseInt(this.selecteVehicle.toString()))}):this.form.controls.vehicle_id.setValue(null)})}gettodayRange(){let t=new Date,i=new Date(t);i.setDate(t.getDate()),i.setHours(0,0,0,0);let e=new Date(t);return e.setDate(t.getDate()),e.setHours(23,59,59,999),{start:i.toISOString(),end:e.toISOString()}}constructor(t,i,e,a,G){this.document=t,this.formatter=i,this.renderer=e,this.store=a,this.formBuilder=G,this.selectedTypes=[1],this.balance=0,this.search=new A,this.type_stops=[{value:!1,label:"R\xE9sum\xE9"},{value:!0,label:"Rpport journalier"}],this.tableConfig={columns:[{title:"Heure de d\xE9part",dataField:"startTime",type:"date"},{title:"Date de fin",dataField:"endTime",type:"date"},{title:"Dur\xE9e",dataField:"duration"},{title:"Adresse",dataField:"address"}],data:[],total:0},this.form=this.formBuilder.group({consumer_id:new S("",[B.required]),vehicle_id:new S(null),daily:new S(!1),balance:new S("",[B.required])}),this.form.controls.vehicle_id.valueChanges.subscribe(b=>{b?(this.paginateInitialData.daily=this.form.get("daily")?.value,this.paginateInitialData.vehicle_id=b,this.store.dispatch(new u(this.paginateInitialData)),this.stop$.subscribe(C=>{this.tableConfig.data=C?C?.data:[],this.tableConfig.total=C?C?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(t){this.paginateInitialData=t;let i=this.form.controls.vehicle_id?.value;this.paginateInitialData.vehicle_id=i,this.paginateInitialData.daily=this.form.get("daily")?.value,this.paginateInitialData.from=t.start_date,this.paginateInitialData.to=t.end_date,i&&this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new u(t))}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}productDropdown(t){t.innerSearchText&&this.search.next("")}searchProduct(t){this.search.next(t.search)}changeSelect(){this.form?.get("daily")?.value&&(this.paginateInitialData.daily=this.form.get("daily")?.value),this.paginateInitialData&&this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new u(this.paginateInitialData))}};g.\u0275fac=function(i){return new(i||g)(h(z),h(dt),h(q),h(tt),h(ct))},g.\u0275cmp=P({type:g,selectors:[["app-stop"]],viewQuery:function(i,e){if(i&1&&(V(jt,5),V(xt,5)),i&2){let a;F(a=M())&&(e.tableMain=a.first),F(a=M())&&(e.ConfirmationModal=a.first)}},decls:14,vars:24,consts:[["tableTable",""],[1,"row","g-0"],["class","col-xxl-4 col-xl-5",4,"ngIf"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","vehicle_id",1,"custom-select",3,"data","placeholder"],[3,"tableChanged","dateRange","tableConfig"],[1,"col-xxl-4","col-xl-5"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"]],template:function(i,e){if(i&1){let a=k();f(0,"div",1),H(1,Tt,7,12,"div",2),l(2,"async"),f(3,"div"),l(4,"async"),f(5,"form",3)(6,"app-page-wrapper",4),T(7,"select2",5),l(8,"async"),l(9,"async"),l(10,"translate"),_()()()(),f(11,"app-page-wrapper",4)(12,"app-table",6,0),L("tableChanged",function(b){return Q(a),O(e.onTableChange(b))}),_()()}if(i&2){let a;r(),n("ngIf",p(2,13,e.roleName$)==="admin"),r(2),U("col-xxl-",p(4,15,e.roleName$)==="admin"?8:6," col-xl-5 col-offset-2 col-offset-2"),r(2),n("formGroup",e.form),r(),n("gridClass","col-sm-12")("title","select_vehicle"),r(),n("data",(a=p(8,17,e.vehicle$))!=null&&a.length?p(9,19,e.vehicle$):$(23,wt))("placeholder",p(10,21,"select_vehicle")),r(4),n("gridClass","col-sm-12")("title","stops"),r(),n("dateRange",!0)("tableConfig",e.tableConfig)}},dependencies:[J,st,rt,nt,lt,pt,gt,yt,vt,K,ut]});var d=g;s([y(N.users)],d.prototype,"users$",void 0);s([y(m.stop)],d.prototype,"stop$",void 0);s([y(j.vehicles)],d.prototype,"vehicle$",void 0);s([y(ft.getRoleName)],d.prototype,"roleName$",void 0);var Vt=[{path:"",component:d,canActivate:[bt],data:{permission:"stop.index"}}],_t=(()=>{let t=class t{};t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=w({type:t}),t.\u0275inj=D({imports:[R.forChild(Vt),R]});let o=t;return o})();var be=(()=>{let t=class t{};t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=w({type:t}),t.\u0275inj=D({imports:[X,_t,St,et.forFeature([N,m,j])]});let o=t;return o})();export{be as StopModule};
