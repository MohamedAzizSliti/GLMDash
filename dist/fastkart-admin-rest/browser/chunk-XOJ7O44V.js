import{a as X}from"./chunk-ISOQKGNC.js";import{Dc as K,Fa as H,Ob as J,a as I,cb as O,k as C,l as D,lb as W,m as V,n as L,o as q,p as B,qb as z}from"./chunk-X2K52VJG.js";import{$ as u,Bc as G,Ca as R,Da as N,S as _,Sa as b,Sc as x,Y as m,Z as l,ab as j,bb as M,da as $,ea as h,gb as A,h as d,jb as F,la as y,ma as g,rb as U,sb as k,tb as E,vc as Q}from"./chunk-V4SAOAZP.js";import{a as T,b as P}from"./chunk-CWTPBX7D.js";var w=(()=>{let t=class t{constructor(e){this.payload=e}};t.type="[Refund] Get";let o=t;return o})(),S=(()=>{let t=class t{constructor(e,r){this.id=e,this.status=r}};t.type="[Refund] Put";let o=t;return o})();var Y=(()=>{let t=class t{constructor(e){this.http=e}getRefunds(e){return this.http.get(`${I.URL}/refund`,{params:e})}updaterefundStatus(e,r){return this.http.put(`${I.URL}/refund/${e}`,{status:r})}};t.\u0275fac=function(r){return new(r||t)(u(G))},t.\u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var n,s=(n=class{constructor(t,i,e){this.store=t,this.notificationService=i,this.refundService=e}static refund(t){return t.refund}getRefund(t,i){return this.refundService.getRefunds(i.payload).pipe(_({next:e=>{t.patchState({refund:{data:e.data,total:e?.total?e?.total:e.data?.length}})},error:e=>{throw new Error(e?.error?.message)}}))}updateRefundStatus(t,{id:i,status:e}){return this.refundService.updaterefundStatus(i,e).pipe(_({next:r=>{if(typeof r=="object"){let p=t.getState(),a=[...p.refund.data],tt=a.findIndex(et=>et.id===i);a[tt]=r,t.patchState(P(T({},p),{refund:{data:a,total:p.refund.total}})),this.store.dispatch(new O("/refund",r?.total_pending_refunds))}},complete:()=>{this.notificationService.showSuccess("Refund Status Updated Successfully")},error:r=>{throw new Error(r?.error?.message)}}))}},n.\u0275fac=function(i){return new(i||n)(u(C),u(H),u(Y))},n.\u0275prov=m({token:n,factory:n.\u0275fac}),n);d([V(w)],s.prototype,"getRefund",null);d([V(S)],s.prototype,"updateRefundStatus",null);d([B()],s,"refund",null);s=d([L({name:"refund",defaults:{refund:{data:[],total:0}}})],s);var it=["payoutModal"],c=class c{constructor(t){this.store=t,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"order_number",dataField:"order_id"},{title:"consumer_name",dataField:"consumer_name",sortable:!0,sort_direction:"desc"},{title:"status",dataField:"refund_status"},{title:"created_at",dataField:"created_at",type:"date",sortable:!0,sort_direction:"desc"}],rowActions:[{label:"View",actionToPerform:"view",icon:"ri-eye-line"}],data:[],total:0}}ngOnInit(){this.refund$.subscribe(t=>{let i=t?.data?.filter(e=>(e.consumer_name=e?.user?.name,e.order_id=`<span class="fw-bolder">#${e?.order?.order_number}</span>`,e.refund_status=e.status?`<div class="status-${e.status}"><span>${e.status.replace(/_/g," ")}</span></div>`:"-",e));this.tableConfig.data=t?i:[],this.tableConfig.total=t?t?.total:0})}onActionClicked(t){t.actionToPerform=="view"&&this.PayoutModal.openModal(t.data)}onTableChange(t){this.store.dispatch(new w(t))}approved(t){this.store.dispatch(new S(t.data.id,t.status))}};c.\u0275fac=function(i){return new(i||c)(N(C))},c.\u0275cmp=$({type:c,selectors:[["app-refund"]],viewQuery:function(i,e){if(i&1&&U(it,5),i&2){let r;k(r=E())&&(e.PayoutModal=r.first)}},decls:4,vars:5,consts:[["payoutModal",""],[3,"gridClass","title"],[3,"tableChanged","action","tableConfig"],[3,"payout","label","action"]],template:function(i,e){if(i&1){let r=A();j(0,"app-page-wrapper",1)(1,"app-table",2),F("tableChanged",function(a){return y(r),g(e.onTableChange(a))})("action",function(a){return y(r),g(e.onActionClicked(a))}),M()(),j(2,"app-payout-modal",3,0),F("payout",function(a){return y(r),g(e.approved(a))}),M()}i&2&&(b("gridClass","col-sm-12")("title","refund"),R(),b("tableConfig",e.tableConfig),R(),b("label","refund")("action",!1))},dependencies:[z,W,J]});var f=c;d([q(s.refund)],f.prototype,"refund$",void 0);var at=[{path:"",component:f,canActivate:[X],data:{permission:"refund.index"}}],Z=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=h({type:t}),t.\u0275inj=l({imports:[x.forChild(at),x]});let o=t;return o})();var Ut=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=h({type:t}),t.\u0275inj=l({imports:[Q,Z,K,D.forFeature([s])]});let o=t;return o})();export{Ut as RefundModule};
