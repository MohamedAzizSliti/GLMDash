import{g as Te}from"./chunk-UG2VPS2O.js";import{a as V}from"./chunk-HCMAZYZ2.js";import"./chunk-K5FNPDN3.js";import{a as Ne,m as F}from"./chunk-O55BQOZL.js";import{a as _e}from"./chunk-ISOQKGNC.js";import{A as le,B as pe,Dc as De,E as w,Fa as ve,G as ce,Ga as ge,L as me,O as de,Pb as Ie,T as fe,a as ie,aa as he,ca as ue,fb as be,k as oe,l as re,lb as Ce,m as ae,n as ne,o as S,p as se,qb as Se,yb as we,z as A}from"./chunk-X2K52VJG.js";import{$ as b,Bc as te,Ca as a,Da as g,Ia as k,Ib as E,Nb as s,Ob as l,Qa as W,S as U,Sa as n,Sc as R,Vc as ye,Xa as x,Y as _,Z as N,ab as m,bb as C,bc as X,c as Q,cb as j,da as q,ea as T,gb as z,h as p,jb as J,kb as K,kc as Y,la as H,ma as L,nc as Z,rb as M,sb as B,tb as G,vc as ee}from"./chunk-V4SAOAZP.js";import"./chunk-CWTPBX7D.js";var I=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Event] Event Get";let o=e;return o})();var je=(()=>{let e=class e{constructor(t){this.http=t}getEvents(t){return this.http.get(`${ie.URL}/traccar/reports/events`,{params:t})}};e.\u0275fac=function(r){return new(r||e)(b(te))},e.\u0275prov=_({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var c,d=(c=class{constructor(e,i){this.notificationService=e,this.eventService=i}static event(e){return e.event}getEvents(e,{payload:i}){return this.eventService.getEvents(i).pipe(U({next:t=>{console.log("/***** The Value result result ****/"),console.log(t),e.patchState({event:{data:t.data,total:t?.total?t?.total:t.data?.length}})},error:t=>{throw new Error(t?.error?.message)}}))}},c.\u0275fac=function(i){return new(i||c)(b(ve),b(je))},c.\u0275prov=_({token:c,factory:c.\u0275fac}),c);p([ae(I)],d.prototype,"getEvents",null);p([se()],d,"event",null);d=p([ne({name:"event",defaults:{event:{data:[],total:0}}})],d);var xe=["tableTable"],Me=["confirmationModal"],O=()=>[];function Be(o,e){if(o&1&&(m(0,"div",8)(1,"form",3)(2,"app-page-wrapper",4),j(3,"select2",9),s(4,"async"),s(5,"async"),s(6,"translate"),C()()()),o&2){let i,t=K();a(),n("formGroup",t.form),a(),n("gridClass","col-sm-12")("title","select_consumer"),a(),n("data",(i=l(4,5,t.users$))!=null&&i.length?l(5,7,t.users$):E(11,O))("placeholder",l(6,9,"select_consumer"))}}function Ee(o){return new he(o.year,o.month,o.day)}var y=class y{ngOnInit(){this.store.dispatch(new Ne({status:1}));let e=this.gettodayRange();this.todayStartAt=e.start,this.todayEndAt=e.end,setTimeout(()=>{this.tableMain.onDateSelection(Ee(this.formatter.parse(e.start))),this.tableMain.onDateSelection(Ee(this.formatter.parse(e.end)))}),this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.vehicle$.subscribe(i=>{this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.selecteVehicle?setTimeout(()=>{this.form.controls.vehicle_id.setValue(parseInt(this.selecteVehicle.toString()))}):this.form.controls.vehicle_id.setValue(null)})}gettodayRange(){let e=new Date,i=new Date(e);i.setDate(e.getDate()),i.setHours(0,0,0,0);let t=new Date(e);return t.setDate(e.getDate()),t.setHours(23,59,59,999),{start:i.toISOString(),end:t.toISOString()}}constructor(e,i,t,r,P){this.document=e,this.formatter=i,this.renderer=t,this.store=r,this.formBuilder=P,this.selectedTypes=[1],this.balance=0,this.search=new Q,this.type_events=Te,this.tableConfig={columns:[{title:"No.",dataField:"id",type:"no"},{title:"event",dataField:"type"},{title:"Date",dataField:"eventTime",type:"date"}],data:[],total:0},this.roleName$.subscribe(v=>{v=="admin"&&this.store.dispatch(new Ie({role:"consumer",status:1}))}),this.form=this.formBuilder.group({consumer_id:new w("",[A.required]),vehicle_id:new w(null),type:new w("allEvents"),balance:new w("",[A.required])}),this.form.controls.vehicle_id.valueChanges.subscribe(v=>{if(v){let Fe=this.selectedTypes.map(h=>{let D=this.type_events.find(u=>u.id===h);return D?D.value:h});this.paginateInitialData.type=Fe.join(","),this.paginateInitialData.vehicle_id=v,this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new I(this.paginateInitialData)),this.event$.subscribe(h=>{let D=h?.data?.filter(u=>(u.type=u.type?`<div class="status-${u.type}"><span>${this.getLibelle(u.type)}</span></div>`:"-",u));this.tableConfig.data=h?D:[],this.tableConfig.total=h?h?.total:0}),this.renderer.addClass(this.document.body,"loader-none")}else this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset()})}onTableChange(e){this.paginateInitialData=e;let i=this.form.controls.vehicle_id?.value;this.paginateInitialData.vehicle_id=i,this.paginateInitialData.from=e.start_date,this.paginateInitialData.to=e.end_date,i&&this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new I(e))}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}productDropdown(e){e.innerSearchText&&this.search.next("")}searchProduct(e){this.search.next(e.search)}getLibelle(e){let i=this.type_events.find(t=>t.value===e);return i?i.name:e}};y.\u0275fac=function(i){return new(i||y)(g(X),g(ue),g(k),g(oe),g(fe))},y.\u0275cmp=q({type:y,selectors:[["app-event"]],viewQuery:function(i,t){if(i&1&&(M(xe,5),M(Me,5)),i&2){let r;B(r=G())&&(t.tableMain=r.first),B(r=G())&&(t.ConfirmationModal=r.first)}},decls:19,vars:36,consts:[["tableTable",""],[1,"row","g-0"],["class","col-xxl-4 col-xl-5",4,"ngIf"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","vehicle_id",1,"custom-select",3,"data","placeholder"],[2,"width","88%",3,"position","selectedOption","options"],[3,"tableChanged","dateRange","tableConfig"],[1,"col-xxl-4","col-xl-5"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"]],template:function(i,t){if(i&1){let r=z();m(0,"div",1),W(1,Be,7,12,"div",2),s(2,"async"),m(3,"div"),s(4,"async"),m(5,"form",3)(6,"app-page-wrapper",4),j(7,"select2",5),s(8,"async"),s(9,"async"),s(10,"translate"),C()()(),m(11,"div"),s(12,"async"),m(13,"form",3)(14,"app-page-wrapper",4),j(15,"app-advanced-dropdown",6),C()()()(),m(16,"app-page-wrapper",4)(17,"app-table",7,0),J("tableChanged",function(v){return H(r),L(t.onTableChange(v))}),C()()}if(i&2){let r;a(),n("ngIf",l(2,22,t.roleName$)==="admin"),a(2),x("col-xxl-",l(4,24,t.roleName$)==="admin"?4:6," col-xl-5 col-offset-2 col-offset-2"),a(2),n("formGroup",t.form),a(),n("gridClass","col-sm-12")("title","select_vehicle"),a(),n("data",(r=l(8,26,t.vehicle$))!=null&&r.length?l(9,28,t.vehicle$):E(34,O))("placeholder",l(10,30,"select_vehicle")),a(4),x("col-xxl-",l(12,32,t.roleName$)==="admin"?4:6," col-xl-4"),a(2),n("formGroup",t.form),a(),n("gridClass","col-sm-12")("title","select_type"),a(),n("position","bottom")("selectedOption",t.selectedTypes)("options",t.type_events!=null&&t.type_events.length?t.type_events:E(35,O)),a(),n("gridClass","col-sm-12")("title","events"),a(),n("dateRange",!0)("tableConfig",t.tableConfig)}},dependencies:[Y,ce,le,pe,me,de,be,Se,Ce,we,Z,ye]});var f=y;p([S(V.users)],f.prototype,"users$",void 0);p([S(d.event)],f.prototype,"event$",void 0);p([S(F.vehicles)],f.prototype,"vehicle$",void 0);p([S(ge.getRoleName)],f.prototype,"roleName$",void 0);var Ge=[{path:"",component:f,canActivate:[_e],data:{permission:"event.index"}}],Ve=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=T({type:e}),e.\u0275inj=N({imports:[R.forChild(Ge),R]});let o=e;return o})();var Et=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=T({type:e}),e.\u0275inj=N({imports:[ee,Ve,De,re.forFeature([V,d,F])]});let o=e;return o})();export{Et as EventModule};
