import{a as V}from"./chunk-HCMAZYZ2.js";import"./chunk-K5FNPDN3.js";import{a as De,m as F}from"./chunk-O55BQOZL.js";import{a as Ie}from"./chunk-ISOQKGNC.js";import{A as se,B as le,Dc as Ce,E as I,Fa as fe,G as pe,Ga as ye,L as me,O as ce,T as de,a as te,aa as ue,ca as he,fb as ve,k as ie,l as ae,lb as be,m as re,n as oe,o as C,p as ne,qb as Se,z as A}from"./chunk-X2K52VJG.js";import{$ as b,Bc as ee,Ca as o,Da as g,Ia as k,Ib as N,Nb as s,Ob as l,Qa as L,S as U,Sa as n,Sc as Q,Vc as ge,Xa as $,Y as D,Z as _,ab as d,bb as S,bc as K,c as q,cb as B,da as H,ea as w,gb as W,h as m,jb as R,kb as z,kc as X,la as T,ma as M,nb as J,nc as Y,rb as G,sb as E,tb as P,vc as Z}from"./chunk-V4SAOAZP.js";import"./chunk-CWTPBX7D.js";var f=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Summary] Summary Get";let a=e;return a})();var _e=(()=>{let e=class e{constructor(t){this.http=t}getSummarys(t){return this.http.get(`${te.URL}/traccar/reports/summarys`,{params:t})}};e.\u0275fac=function(r){return new(r||e)(b(ee))},e.\u0275prov=D({token:e,factory:e.\u0275fac,providedIn:"root"});let a=e;return a})();var c,u=(c=class{constructor(e,i){this.notificationService=e,this.summaryService=i}static summary(e){return e.summary}getSummarys(e,{payload:i}){return this.summaryService.getSummarys(i).pipe(U({next:t=>{console.log("/***** The Value result result ****/"),console.log(t),e.patchState({summary:{data:t.data,total:t?.total?t?.total:t.data?.length}})},error:t=>{throw new Error(t?.error?.message)}}))}},c.\u0275fac=function(i){return new(i||c)(b(fe),b(_e))},c.\u0275prov=D({token:c,factory:c.\u0275fac}),c);m([re(f)],u.prototype,"getSummarys",null);m([ne()],u,"summary",null);u=m([oe({name:"summary",defaults:{summary:{data:[],total:0}}})],u);var Fe=["confirmationModal"],je=["tableTable"],O=()=>[];function xe(a,e){if(a&1&&(d(0,"div",8)(1,"form",3)(2,"app-page-wrapper",4),B(3,"select2",9),s(4,"async"),s(5,"async"),s(6,"translate"),S()()()),a&2){let i,t=z();o(),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","select_consumer"),o(),n("data",(i=l(4,5,t.users$))!=null&&i.length?l(5,7,t.users$):N(11,O))("placeholder",l(6,9,"select_consumer"))}}function we(a){return new ue(a.year,a.month,a.day)}var v=class v{ngOnInit(){let e=this.gettodayRange();setTimeout(()=>{this.tableMain.onDateSelection(we(this.formatter.parse(e.start))),this.tableMain.onDateSelection(we(this.formatter.parse(e.end)))}),this.store.dispatch(new De({status:1})),this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.vehicle$.subscribe(i=>{this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.selecteVehicle?setTimeout(()=>{this.form.controls.vehicle_id.setValue(parseInt(this.selecteVehicle.toString()))}):this.form.controls.vehicle_id.setValue(null)})}constructor(e,i,t,r,x){this.document=e,this.formatter=i,this.renderer=t,this.store=r,this.formBuilder=x,this.selectedTypes=[1],this.balance=0,this.search=new q,this.type_summarys=[{value:!1,label:"R\xE9sum\xE9"},{value:!0,label:"Rpport journalier"}],this.tableConfig={columns:[{title:"Appareil",dataField:"deviceName"},{title:"Date de d\xE9part",dataField:"startTime",type:"date"},{title:"Distance",dataField:"distance",type:"distance"},{title:"Vitesse moyenne",dataField:"averageSpeed",type:"speed"},{title:"Vitesse maximum",dataField:"maxSpeed",type:"speed"},{title:"Cosommation de carburant",dataField:"fuel_cost",type:"price"}],data:[],total:0},this.form=this.formBuilder.group({consumer_id:new I("",[A.required]),vehicle_id:new I(null),daily:new I(!1),balance:new I("",[A.required])}),this.form.controls.vehicle_id.valueChanges.subscribe(y=>{y?(this.paginateInitialData.daily=this.form.get("daily")?.value,this.paginateInitialData.vehicle_id=y,this.paginateInitialData.claculate_fuel=!0,this.store.dispatch(new f(this.paginateInitialData)),this.summary$.subscribe(p=>{this.tableConfig.data=p?p?.data:[],this.tableConfig.total=p?p?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())}),this.form.controls.daily.valueChanges.subscribe(y=>{y!=null&&(this.paginateInitialData.daily=this.form.get("daily")?.value,this.store.dispatch(new f(this.paginateInitialData)),this.summary$.subscribe(p=>{this.tableConfig.data=p?p?.data:[],this.tableConfig.total=p?p?.total:0}),this.renderer.addClass(this.document.body,"loader-none"))})}onTableChange(e){this.paginateInitialData=e;let i=this.form.controls.vehicle_id?.value;this.paginateInitialData.vehicle_id=i,this.paginateInitialData.daily=this.form.get("daily")?.value,this.paginateInitialData.from=e.start_date,this.paginateInitialData.to=e.end_date,i&&this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new f(e))}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}productDropdown(e){e.innerSearchText&&this.search.next("")}searchProduct(e){this.search.next(e.search)}changeSelect(){this.form?.get("daily")?.value&&(this.paginateInitialData.daily=this.form.get("daily")?.value),this.paginateInitialData&&this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new f(this.paginateInitialData))}gettodayRange(){let e=new Date,i=new Date(e);i.setDate(e.getDate()),i.setHours(0,0,0,0);let t=new Date(e);return t.setDate(e.getDate()),t.setHours(23,59,59,999),{start:i.toISOString(),end:t.toISOString()}}};v.\u0275fac=function(i){return new(i||v)(g(K),g(he),g(k),g(ie),g(de))},v.\u0275cmp=H({type:v,selectors:[["app-summary"]],viewQuery:function(i,t){if(i&1&&(G(Fe,5),G(je,5)),i&2){let r;E(r=P())&&(t.ConfirmationModal=r.first),E(r=P())&&(t.tableMain=r.first)}},decls:21,vars:40,consts:[["tableTable",""],[1,"row","g-0"],["class","col-xxl-4 col-xl-5",4,"ngIf"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","vehicle_id",1,"custom-select",3,"data","placeholder"],["formControlName","daily","id","store_id","resettable","",1,"custom-select",3,"update","placeholder","data","noResultMessage"],[3,"tableChanged","dateRange","tableConfig"],[1,"col-xxl-4","col-xl-5"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"]],template:function(i,t){if(i&1){let r=W();d(0,"div",1),L(1,xe,7,12,"div",2),s(2,"async"),d(3,"div"),s(4,"async"),d(5,"form",3)(6,"app-page-wrapper",4),B(7,"select2",5),s(8,"async"),s(9,"async"),s(10,"translate"),S()()(),d(11,"div"),s(12,"async"),d(13,"form",3)(14,"app-page-wrapper",4)(15,"select2",6),s(16,"translate"),s(17,"translate"),R("update",function(){return T(r),M(t.changeSelect())}),S()()()()(),d(18,"app-page-wrapper",4)(19,"app-table",7,0),R("tableChanged",function(y){return T(r),M(t.onTableChange(y))}),S()()}if(i&2){let r;o(),n("ngIf",l(2,22,t.roleName$)==="admin"),o(2),$("col-xxl-",l(4,24,t.roleName$)==="admin"?4:6," col-xl-5 col-offset-2 col-offset-2"),o(2),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","select_vehicle"),o(),n("data",(r=l(8,26,t.vehicle$))!=null&&r.length?l(9,28,t.vehicle$):N(38,O))("placeholder",l(10,30,"select_vehicle")),o(4),$("col-xxl-",l(12,32,t.roleName$)==="admin"?4:6," col-xl-4"),o(2),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","select_type"),o(),J("noResultMessage",l(16,34,"no_data_found")),n("placeholder",l(17,36,"select_type"))("data",t.type_summarys!=null&&t.type_summarys.length?t.type_summarys:N(39,O)),o(3),n("gridClass","col-sm-12")("title","summarys"),o(),n("dateRange",!0)("tableConfig",t.tableConfig)}},dependencies:[X,pe,se,le,me,ce,ve,Se,be,Y,ge]});var h=v;m([C(V.users)],h.prototype,"users$",void 0);m([C(u.summary)],h.prototype,"summary$",void 0);m([C(F.vehicles)],h.prototype,"vehicle$",void 0);m([C(ye.getRoleName)],h.prototype,"roleName$",void 0);var Te=[{path:"",component:h,canActivate:[Ie],data:{permission:"summary.index"}}],Ne=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=w({type:e}),e.\u0275inj=_({imports:[Q.forChild(Te),Q]});let a=e;return a})();var Ct=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=w({type:e}),e.\u0275inj=_({imports:[Z,Ne,Ce,ae.forFeature([V,u,F])]});let a=e;return a})();export{Ct as SummaryModule};
