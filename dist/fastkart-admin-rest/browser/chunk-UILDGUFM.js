import{a as N}from"./chunk-HCMAZYZ2.js";import"./chunk-K5FNPDN3.js";import{a as we,m as F}from"./chunk-O55BQOZL.js";import{a as Ie}from"./chunk-ISOQKGNC.js";import{A as se,B as le,Dc as Se,E as C,Fa as he,G as pe,Ga as ge,L as ce,O as me,T as de,a as te,aa as ue,ca as fe,fb as ve,k as ie,l as ae,lb as be,m as re,n as oe,o as b,p as ne,qb as Ce,z as Q}from"./chunk-X2K52VJG.js";import{$ as y,Bc as ee,Ca as o,Da as f,Ia as k,Ib as R,Nb as s,Ob as l,Qa as L,S as H,Sa as n,Sc as P,Vc as ye,Xa as M,Y as w,Z as D,ab as m,bb as v,bc as K,c as q,cb as B,da as U,ea as _,gb as W,h as p,jb as $,kb as z,kc as X,la as x,ma as T,nb as J,nc as Y,rb as A,sb as G,tb as E,vc as Z}from"./chunk-V4SAOAZP.js";import"./chunk-CWTPBX7D.js";var h=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Route] Route Get";let a=e;return a})();var De=(()=>{let e=class e{constructor(t){this.http=t}getRoutes(t){return this.http.get(`${te.URL}/traccar/reports/route`,{params:t})}};e.\u0275fac=function(r){return new(r||e)(y(ee))},e.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"});let a=e;return a})();var c,d=(c=class{constructor(e,i){this.notificationService=e,this.routeService=i}static route(e){return e.route}getRoutes(e,{payload:i}){return this.routeService.getRoutes(i).pipe(H({next:t=>{e.patchState({route:{data:t.data,total:t?.total?t?.total:t.data?.length}})},error:t=>{throw new Error(t?.error?.message)}}))}},c.\u0275fac=function(i){return new(i||c)(y(he),y(De))},c.\u0275prov=w({token:c,factory:c.\u0275fac}),c);p([re(h)],d.prototype,"getRoutes",null);p([ne()],d,"route",null);d=p([oe({name:"route",defaults:{route:{data:[],total:0}}})],d);var Fe=["tableTable"],Ve=["confirmationModal"],O=()=>[];function je(a,e){if(a&1&&(m(0,"div",8)(1,"form",3)(2,"app-page-wrapper",4),B(3,"select2",9),s(4,"async"),s(5,"async"),s(6,"translate"),v()()()),a&2){let i,t=z();o(),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","select_consumer"),o(),n("data",(i=l(4,5,t.users$))!=null&&i.length?l(5,7,t.users$):R(11,O))("placeholder",l(6,9,"select_consumer"))}}function _e(a){return new ue(a.year,a.month,a.day)}var g=class g{ngOnInit(){this.store.dispatch(new we({status:1}));let e=this.gettodayRange();this.todayStartAt=e.start,this.todayEndAt=e.end,setTimeout(()=>{this.tableMain.onDateSelection(_e(this.formatter.parse(e.start))),this.tableMain.onDateSelection(_e(this.formatter.parse(e.end)))}),this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.vehicle$.subscribe(i=>{this.selecteVehicle=localStorage.getItem("selectedVehicle"),this.selecteVehicle?setTimeout(()=>{this.form.controls.vehicle_id.setValue(parseInt(this.selecteVehicle.toString()))}):this.form.controls.vehicle_id.setValue(null)})}gettodayRange(){let e=new Date,i=new Date(e);i.setDate(e.getDate()),i.setHours(0,0,0,0);let t=new Date(e);return t.setDate(e.getDate()),t.setHours(23,59,59,999),{start:i.toISOString(),end:t.toISOString()}}constructor(e,i,t,r,j){this.document=e,this.formatter=i,this.renderer=t,this.store=r,this.formBuilder=j,this.selectedTypes=[1],this.balance=0,this.search=new q,this.type_routes=[{value:!1,label:"R\xE9sum\xE9"},{value:!0,label:"Rpport journalier"}],this.tableConfig={columns:[{title:"Heure de d\xE9part",dataField:"startTime",type:"date"},{title:"Date de fin",dataField:"endTime",type:"date"},{title:"Distance",dataField:"distance"},{title:"Vitesse moyenne",dataField:"averageSpeed"},{title:"Vitesse maximum",dataField:"maxSpeed"},{title:"Adresse de d\xE9part",dataField:"startAddress"},{title:"Adresse de fin",dataField:"endAddress"},{title:"Dur\xE9e",dataField:"duration"}],data:[],total:0},this.form=this.formBuilder.group({consumer_id:new C("",[Q.required]),vehicle_id:new C(null),daily:new C(!1),balance:new C("",[Q.required])}),this.form.controls.vehicle_id.valueChanges.subscribe(S=>{S?(this.paginateInitialData.daily=this.form.get("daily")?.value,this.paginateInitialData.vehicle_id=S,this.store.dispatch(new h(this.paginateInitialData)),this.route$.subscribe(I=>{this.tableConfig.data=I?I?.data:[],this.tableConfig.total=I?I?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(e){this.paginateInitialData=e;let i=this.form.controls.vehicle_id?.value;this.paginateInitialData.vehicle_id=i,this.paginateInitialData.daily=this.form.get("daily")?.value,this.paginateInitialData.from=e.start_date,this.paginateInitialData.to=e.end_date,i&&this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new h(e))}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}productDropdown(e){e.innerSearchText&&this.search.next("")}searchProduct(e){this.search.next(e.search)}changeSelect(){this.form?.get("daily")?.value&&(this.paginateInitialData.daily=this.form.get("daily")?.value),this.paginateInitialData&&this.paginateInitialData.from&&this.paginateInitialData.to&&this.store.dispatch(new h(this.paginateInitialData))}};g.\u0275fac=function(i){return new(i||g)(f(K),f(fe),f(k),f(ie),f(de))},g.\u0275cmp=U({type:g,selectors:[["app-route"]],viewQuery:function(i,t){if(i&1&&(A(Fe,5),A(Ve,5)),i&2){let r;G(r=E())&&(t.tableMain=r.first),G(r=E())&&(t.ConfirmationModal=r.first)}},decls:21,vars:40,consts:[["tableTable",""],[1,"row","g-0"],["class","col-xxl-4 col-xl-5",4,"ngIf"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","vehicle_id",1,"custom-select",3,"data","placeholder"],["formControlName","daily","id","store_id","resettable","",1,"custom-select",3,"update","placeholder","data","noResultMessage"],[3,"tableChanged","dateRange","tableConfig"],[1,"col-xxl-4","col-xl-5"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"]],template:function(i,t){if(i&1){let r=W();m(0,"div",1),L(1,je,7,12,"div",2),s(2,"async"),m(3,"div"),s(4,"async"),m(5,"form",3)(6,"app-page-wrapper",4),B(7,"select2",5),s(8,"async"),s(9,"async"),s(10,"translate"),v()()(),m(11,"div"),s(12,"async"),m(13,"form",3)(14,"app-page-wrapper",4)(15,"select2",6),s(16,"translate"),s(17,"translate"),$("update",function(){return x(r),T(t.changeSelect())}),v()()()()(),m(18,"app-page-wrapper",4)(19,"app-table",7,0),$("tableChanged",function(S){return x(r),T(t.onTableChange(S))}),v()()}if(i&2){let r;o(),n("ngIf",l(2,22,t.roleName$)==="admin"),o(2),M("col-xxl-",l(4,24,t.roleName$)==="admin"?4:6," col-xl-5 col-offset-2 col-offset-2"),o(2),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","select_vehicle"),o(),n("data",(r=l(8,26,t.vehicle$))!=null&&r.length?l(9,28,t.vehicle$):R(38,O))("placeholder",l(10,30,"select_vehicle")),o(4),M("col-xxl-",l(12,32,t.roleName$)==="admin"?4:6," col-xl-4"),o(2),n("formGroup",t.form),o(),n("gridClass","col-sm-12")("title","select_type"),o(),J("noResultMessage",l(16,34,"no_data_found")),n("placeholder",l(17,36,"select_type"))("data",t.type_routes!=null&&t.type_routes.length?t.type_routes:R(39,O)),o(3),n("gridClass","col-sm-12")("title","routes"),o(),n("dateRange",!0)("tableConfig",t.tableConfig)}},dependencies:[X,pe,se,le,ce,me,ve,Ce,be,Y,ye]});var u=g;p([b(N.users)],u.prototype,"users$",void 0);p([b(d.route)],u.prototype,"route$",void 0);p([b(F.vehicles)],u.prototype,"vehicle$",void 0);p([b(ge.getRoleName)],u.prototype,"roleName$",void 0);var xe=[{path:"",component:u,canActivate:[Ie],data:{permission:"route.index"}}],Re=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=_({type:e}),e.\u0275inj=D({imports:[P.forChild(xe),P]});let a=e;return a})();var St=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=_({type:e}),e.\u0275inj=D({imports:[Z,Re,Se,ae.forFeature([N,d,F])]});let a=e;return a})();export{St as RouteModule};
