import{a as k}from"./chunk-HCMAZYZ2.js";import"./chunk-K5FNPDN3.js";import{a as Tt}from"./chunk-ISOQKGNC.js";import{$a as Ct,A as pt,B as lt,Cc as Pt,Dc as It,E as H,Fa as bt,G as mt,H as dt,L as ut,O as ft,Pb as xt,T as ht,Ua as _t,a as D,ab as yt,fb as gt,k as nt,l as rt,lb as wt,m as E,n as at,o as L,p as st,qb as St,y as ct,z as O}from"./chunk-X2K52VJG.js";import{$ as C,Bc as ot,Ca as r,Da as w,Ia as z,Ib as Z,Nb as f,Ob as h,Qa as J,S as T,Sa as a,Sc as q,Vc as vt,Wa as $,Y as F,Z as M,ab as c,bb as p,bc as tt,cb as j,da as W,ea as N,gb as V,h as m,jb as S,kb as x,la as y,ma as g,nc as et,rb as K,sb as X,tb as Y,ub as A,vc as it,wb as P,xb as R,yb as Q}from"./chunk-V4SAOAZP.js";import"./chunk-CWTPBX7D.js";var I=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Point] Transaction Get";let o=e;return o})(),B=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Point] Credit";let o=e;return o})(),U=(()=>{let e=class e{constructor(t){this.payload=t}};e.type="[Point] Debit";let o=e;return o})();var Ft=(()=>{let e=class e{constructor(t){this.http=t}getUserTransaction(t){return this.http.get(`${D.URL}/points/consumer`,{params:t})}credit(t){return this.http.post(`${D.URL}/credit/points`,t)}debit(t){return this.http.post(`${D.URL}/debit/points`,t)}};e.\u0275fac=function(n){return new(n||e)(C(ot))},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var d,l=(d=class{constructor(e,i){this.notificationService=e,this.pointService=i}static point(e){return e.point}getUserTransaction(e,{payload:i}){return this.pointService.getUserTransaction(i).pipe(T({next:t=>{e.patchState({point:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},error:t=>{throw e.patchState({point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}),new Error(t?.error?.message)}}))}credit(e,i){return this.pointService.credit(i.payload).pipe(T({next:t=>{e.patchState({point:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},complete:()=>{this.notificationService.showSuccess("Balance Credited Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}debit(e,i){return this.pointService.debit(i.payload).pipe(T({next:t=>{e.patchState({point:{consumer_id:t?.consumer_id,balance:t?.balance,transactions:{data:t?.transactions?.data,total:t?.transactions?.total?t?.transactions?.total:t?.transactions?.data?.length}}})},complete:()=>{this.notificationService.showSuccess("Balance Debited Successfully")},error:t=>{throw new Error(t?.error?.message)}}))}},d.\u0275fac=function(i){return new(i||d)(C(bt),C(Ft))},d.\u0275prov=F({token:d,factory:d.\u0275fac}),d);m([E(I)],l.prototype,"getUserTransaction",null);m([E(B)],l.prototype,"credit",null);m([E(U)],l.prototype,"debit",null);m([st()],l,"point",null);l=m([at({name:"point",defaults:{point:{consumer_id:null,balance:0,transactions:{data:[],total:0}}}})],l);var Vt=["confirmationModal"],Dt=()=>[];function Et(o,e){if(o&1){let i=V();c(0,"app-button",18),S("click",function(){y(i);let n=x();return g(n.form.valid&&n.ConfirmationModal.openModal("credit"))}),P(1),f(2,"translate"),p()}if(o&2){let i=x();$("btn btn-animation"),a("disabled",!i.form.valid)("spinner",!1),r(),Q(" ",h(2,5,"add")," ")}}function kt(o,e){if(o&1){let i=V();c(0,"app-button",19),S("click",function(){y(i);let n=x(),u=A(22);return g((+n.balance<+u.value||!!u.value)&&n.ConfirmationModal.openModal("debit"))}),P(1),f(2,"translate"),p()}if(o&2){let i=x(),t=A(22);$("btn btn-outline"),a("spinner",!1)("disabled",+i.balance<+t.value||!t.value),r(),Q(" ",h(2,5,"withdraw")," ")}}var b=class b{constructor(e,i,t,n){this.document=e,this.renderer=i,this.store=t,this.formBuilder=n,this.balance=0,this.tableConfig={columns:[{title:"No.",dataField:"no",type:"no"},{title:"points",dataField:"amount"},{title:"type",dataField:"type_status"},{title:"remark",dataField:"detail"},{title:"created_at",dataField:"created_at",type:"date"}],data:[],total:0},this.store.dispatch(new xt({role:"consumer",status:1})),this.form=this.formBuilder.group({consumer_id:new H("",[O.required]),balance:new H("",[O.required])}),this.form.controls.consumer_id.valueChanges.subscribe(u=>{u?(this.paginateInitialData.consumer_id=u,this.store.dispatch(new I(this.paginateInitialData)),this.point$.subscribe(s=>{let Nt=s?.transactions?.data?.filter(_=>(_.type_status=_.type?`<div class="status-${_.type}"><span>${_.type.replace(/_/g," ")}</span></div>`:"-",_));this.balance=s?s?.balance:0,this.tableConfig.data=s?Nt:[],this.tableConfig.total=s?s?.transactions?.total:0}),this.renderer.addClass(this.document.body,"loader-none")):(this.balance=0,this.tableConfig.data=[],this.tableConfig.total=0,this.form.controls.balance.reset())})}onTableChange(e){this.paginateInitialData=e;let i=this.form.controls.consumer_id?.value;this.paginateInitialData.consumer_id=i,i&&this.store.dispatch(new I(e))}submit(e){this.form.markAllAsTouched();let i=new B(this.form.value);e=="debit"&&(i=new U(this.form.value)),this.form.valid&&this.store.dispatch(i).subscribe({complete:()=>{this.form.controls.balance.reset()}})}ngOnDestroy(){this.renderer.removeClass(this.document.body,"loader-none")}};b.\u0275fac=function(i){return new(i||b)(w(tt),w(z),w(nt),w(ht))},b.\u0275cmp=W({type:b,selectors:[["app-point"]],viewQuery:function(i,t){if(i&1&&K(Vt,5),i&2){let n;X(n=Y())&&(t.ConfirmationModal=n.first)}},decls:30,vars:25,consts:[["bal",""],["confirmationModal",""],[1,"row","g-0"],[1,"col-xxl-4","col-xl-5"],[3,"formGroup"],[3,"gridClass","title"],["formControlName","consumer_id",1,"custom-select",3,"data","placeholder"],[1,"col-xxl-8","col-xl-7"],[1,"wallet-sec","theme-form"],[1,"wallet-amount"],[1,"wallet-icon"],[1,"ri-copper-diamond-line"],["type","number","formControlName","balance","placeholder","add / withdraw amount","numbersOnly","",1,"form-control"],[1,"btn-sec"],[3,"class","disabled","spinner","click",4,"hasPermission"],[3,"class","spinner","disabled","click",4,"hasPermission"],[3,"tableChanged","dateRange","tableConfig"],[3,"confirmed"],[3,"click","disabled","spinner"],[3,"click","spinner","disabled"]],template:function(i,t){if(i&1){let n=V();c(0,"div",2)(1,"div",3)(2,"form",4)(3,"app-page-wrapper",5),j(4,"select2",6),f(5,"async"),f(6,"async"),f(7,"translate"),p()()(),c(8,"div",7)(9,"form",4)(10,"app-page-wrapper",5)(11,"div",8)(12,"div",9)(13,"div",10),j(14,"i",11),p(),c(15,"div")(16,"h2"),P(17),p(),c(18,"h5"),P(19),f(20,"translate"),p()()(),j(21,"input",12,0),c(23,"div",13),J(24,Et,3,7,"app-button",14)(25,kt,3,7,"app-button",15),p()()()()()(),c(26,"app-page-wrapper",5)(27,"app-table",16),S("tableChanged",function(s){return y(n),g(t.onTableChange(s))}),p()(),c(28,"app-confirmation-modal",17,1),S("confirmed",function(s){return y(n),g(t.submit(s==null?null:s.actionToPerform))}),p()}if(i&2){let n;r(2),a("formGroup",t.form),r(),a("gridClass","col-sm-12")("title","select_consumer"),r(),a("data",(n=h(5,16,t.users$))!=null&&n.length?h(6,18,t.users$):Z(24,Dt))("placeholder",h(7,20,"select_consumer")),r(5),a("formGroup",t.form),r(),a("gridClass","col-sm-12")("title","point"),r(7),R(t.balance==null?null:t.balance.toFixed(2)),r(2),R(h(20,22,"point_balance")),r(5),a("hasPermission","point.credit"),r(),a("hasPermission","point.debit"),r(),a("gridClass","col-sm-12")("title","transactions"),r(),a("dateRange",!0)("tableConfig",t.tableConfig)}},dependencies:[mt,ct,dt,pt,lt,ut,ft,gt,St,wt,_t,Ct,Pt,yt,et,vt]});var v=b;m([L(k.users)],v.prototype,"users$",void 0);m([L(l.point)],v.prototype,"point$",void 0);var Bt=[{path:"",component:v,canActivate:[Tt],data:{permission:"point.index"}}],Mt=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=N({type:e}),e.\u0275inj=M({imports:[q.forChild(Bt),q]});let o=e;return o})();var xe=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=N({type:e}),e.\u0275inj=M({imports:[it,Mt,It,rt.forFeature([k,l])]});let o=e;return o})();export{xe as PointModule};
